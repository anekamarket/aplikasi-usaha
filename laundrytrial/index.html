<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLIKASI MANAJEMEN LAUNDRY</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="toast" class="toast"><i class="fas fa-info-circle"></i> <span id="toast-message"></span></div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal" style="display: flex;">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo"><i class="fas fa-tshirt"></i></div>
                <h1 class="login-title">L-K LAUNDRY</h1>
                <p>Aplikasi Manajemen Laundry</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" id="username" class="form-control" placeholder="Username: operator" onpaste="return false;" autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Password: Gratis12345" onpaste="return false;" autocomplete="current-password">
                </div>
                <div class="form-group">
                    <label for="captchaInput" class="form-label">Verifikasi Keamanan</label>
                    <div class="captcha-container">
                        <span id="captchaText"></span>
                        <i id="refreshCaptcha" class="fas fa-sync-alt"></i>
                    </div>
                     <input type="text" id="captchaInput" class="form-control mt-2" placeholder="Masukkan teks di atas" required>
                </div>
                <button type="submit" class="btn mt-3">Login</button>
            </form>
        </div>
    </div>
    
    <!-- Welcome Splash Modal -->
    <div id="welcomeSplashModal" class="modal">
        <div class="modal-content">
            <div class="splash-header">
                <div class="splash-icon"><i class="fas fa-rocket"></i></div>
                <h2 class="splash-title">Selamat Datang di L-K LAUNDRY!</h2>
            </div>
            <div class="splash-body">
                <p>Login Berhasil!</p>
                <p class="app-description">
                    Aplikasi ini dirancang untuk merevolusi manajemen laundry Anda. Nikmati kemudahan dalam mencatat transaksi, mengelola status order, dan memantau laporan keuangan secara real-time.
                </p>
            </div>
            <div class="splash-footer">
                <p>Powered by <strong>Lentera Karya Situbondo</strong></p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="container" id="mainApp" style="display: none;">
        <header class="app-header">
            <div class="header-title-container">
                <div class="header-logo"><i class="fas fa-tshirt"></i></div>
                <div>
                    <h1 class="app-title" id="storeNameHeader">L-K LAUNDRY</h1>
                    <p id="currentDate"></p>
                    <p id="realTimeClock"></p>
                </div>
            </div>
            <div class="header-info">
                <p>Operator: <span id="loggedInUser">Admin</span></p>
                <div id="shiftStatusContainer">
                    <span id="shiftStatusBadge">Tidak Ada Shift Aktif</span>
                    <button id="shiftActionBtn" class="btn btn-sm btn-warning">Mulai Shift</button>
                </div>
                <div class="dev-info">
                    <a href="https://www.anekamarket.my.id" target="_blank"><i class="fas fa-globe"></i> www.anekamarket.my.id</a> | 
                    <a href="https://wa.me/6287865614222" target="_blank"><i class="fab fa-whatsapp"></i> 087865614222</a>
                </div>
                <p><a href="#" id="logoutBtn" style="margin-top: 5px; display: inline-block;">Logout</a></p>
            </div>
        </header>

        <!-- Main Tabs -->
        <div class="main-tabs">
            <div class="main-tab active" data-tab="newTransactionTab"><i class="fas fa-plus-circle"></i> Transaksi Baru</div>
            <div class="main-tab" data-tab="orderManagementTab"><i class="fas fa-tasks"></i> Manajemen Order</div>
            <div class="main-tab" data-tab="reportsTab"><i class="fas fa-chart-line"></i> Laporan</div>
            <div class="main-tab" data-tab="settingsTab"><i class="fas fa-cog"></i> Pengaturan</div>
        </div>

        <!-- Main Content -->
        <main class="app-content">
            <!-- New Transaction Tab -->
            <div id="newTransactionTab" class="main-tab-content active">
                <div class="app-layout">
                    <section class="panel service-panel">
                        <h2 class="panel-title"><span>Pilih Layanan</span></h2>
                        <div class="service-grid" id="serviceGrid"></div>
                    </section>
                    <section class="panel order-panel">
                        <h2 class="panel-title"><span>Order Laundry</span><span id="orderItemCount">(0 item)</span></h2>
                        <form id="newOrderForm">
                            <div class="form-group">
                                <label class="form-label">Pelanggan</label>
                                <select id="customerSelect" class="form-control"></select>
                                <button type="button" id="addCustomerBtn" class="btn btn-sm btn-info mt-2" style="width: auto;">+ Pelanggan Baru</button>
                            </div>
                            <div class="order-item-list" id="orderItems"><div class="empty-state"><i class="fas fa-file-invoice"></i><p>Pilih layanan untuk memulai</p></div></div>
                            <div class="note-input mt-2">
                                <label class="form-label">Catatan Order (opsional)</label>
                                <textarea id="orderNote" class="form-control" placeholder="Contoh: Baju putih dipisah"></textarea>
                            </div>
                            <div class="summary-container">
                                <div class="form-check">
                                    <input type="checkbox" id="payUpfrontCheckbox" class="form-check-input">
                                    <label for="payUpfrontCheckbox">Bayar di Awal (Lunas)</label>
                                </div>
                                <div id="paymentMethodContainer" class="form-group mt-2" style="display: none;">
                                    <label class="form-label">Metode Pembayaran</label>
                                    <select id="newOrderPaymentMethod" class="form-control">
                                        <option value="cash">Tunai</option><option value="transfer">Transfer</option>
                                    </select>
                                </div>
                                <div class="summary-row total-row"><span>Total Biaya:</span><span id="orderTotal">Rp 0</span></div>
                                <div class="summary-row"><span>Estimasi Selesai:</span><span id="orderDueDate"></span></div>
                            </div>
                            <button type="submit" id="saveOrderBtn" class="btn btn-success mt-3">Simpan Transaksi</button>
                        </form>
                    </section>
                </div>
            </div>

            <!-- Order Management Tab -->
            <div id="orderManagementTab" class="main-tab-content">
                <div class="panel">
                    <h2 class="panel-title">Daftar Order Aktif</h2>
                    <div class="filter-container">
                        <input type="text" id="orderSearch" class="form-control" placeholder="Cari No. Nota atau Nama Pelanggan...">
                        <select id="statusFilter" class="form-control">
                            <option value="all">Semua Status Aktif</option>
                            <option value="antrian">Antrian</option>
                            <option value="proses">Dalam Proses</option>
                            <option value="siap-diambil">Siap Diambil</option>
                        </select>
                        <button id="viewPickedUpHistoryBtn" class="btn btn-info" style="width:auto; white-space:nowrap;">Riwayat Pengambilan</button>
                    </div>
                    <div class="order-management-container" id="orderManagementList"></div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reportsTab" class="main-tab-content">
                 <div class="panel">
                    <h2 class="panel-title">Laporan Keuangan</h2>
                    <div class="form-group d-grid-2">
                        <div><label class="form-label">Dari Tanggal</label><input type="date" id="reportStartDate" class="form-control"></div>
                        <div><label class="form-label">Sampai Tanggal</label><input type="date" id="reportEndDate" class="form-control"></div>
                    </div>
                    <button id="generateReportBtn" class="btn btn-info mb-3">Generate Laporan</button>
                    <div id="reportResults"></div>
                 </div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsTab" class="main-tab-content">
                <div class="panel">
                    <h2 class="panel-title">Panel Pengaturan</h2>
                    <div class="admin-grid">
                        <button id="addServiceBtn" class="btn btn-sm">Tambah Layanan</button>
                        <button id="manageCategoriesBtn" class="btn btn-sm">Kelola Kategori</button>
                        <button id="manageCustomersBtn" class="btn btn-sm">Kelola Pelanggan</button>
                        <button id="manageExpensesBtn" class="btn btn-sm btn-warning">Catat Pengeluaran</button>
                        <button id="historyBtn" class="btn btn-sm">Histori Transaksi</button>
                        <button id="manageStoreInfoBtn" class="btn btn-sm">Info Laundry</button>
                        <button id="controlPanelBtn" class="btn btn-sm">Panel Kontrol</button>
                        <button id="recapReportBtn" class="btn btn-sm btn-success" style="grid-column: 1 / -1;"><i class="fas fa-file-invoice-dollar"></i> Laporan Shift & Rekapitulasi</button>
                    </div>
                    <div class="mt-3">
                        <h4 class="panel-title">Backup & Restore</h4>
                        <div class="backup-actions d-flex gap-2">
                            <button id="backupDataBtn" class="btn btn-sm" style="flex: 1;">Backup Data</button>
                            <label for="restoreFile" class="btn btn-sm btn-info" style="flex: 1; cursor: pointer;"><i class="fas fa-upload"></i> Restore Data</label>
                            <input type="file" id="restoreFile" class="d-none" accept=".json,.lkslaundry">
                        </div>
                        <button id="resetDataBtn" class="btn btn-sm btn-danger mt-2" style="width: 100%;">Reset Semua Data</button>
                    </div>
                </div>
            </div>
        </main>

        <footer class="app-footer">
            <p>&copy; <span id="currentYear"></span> L-K LAUNDRY - Powered by Lentera Karya Situbondo</p>
        </footer>
    </div>
    
    <!-- Quick Action Menu -->
    <div class="quick-action-menu no-print">
        <div class="quick-action-options" id="quickActionOptions">
             <div class="option" id="quickActionAddExpense">
                <span class="label">Catat Pengeluaran</span>
                <span class="icon"><i class="fas fa-file-invoice-dollar"></i></span>
            </div>
            <div class="option" id="quickActionAddService">
                <span class="label">Tambah Layanan</span>
                <span class="icon"><i class="fas fa-tshirt"></i></span>
            </div>
             <div class="option" id="quickActionManageCustomers">
                <span class="label">Kelola Pelanggan</span>
                <span class="icon"><i class="fas fa-users"></i></span>
            </div>
            <div class="option" id="quickActionHistory">
                <span class="label">Histori Transaksi</span>
                <span class="icon"><i class="fas fa-history"></i></span>
            </div>
            <div class="option" id="quickActionRecap">
                <span class="label">Laporan Shift</span>
                <span class="icon"><i class="fas fa-chart-pie"></i></span>
            </div>
             <div class="option" id="quickActionControlPanel">
                <span class="label">Panel Kontrol</span>
                <span class="icon"><i class="fas fa-user-shield"></i></span>
            </div>
            <div class="option" id="quickActionNewOrder">
                <span class="label">Transaksi Baru</span>
                <span class="icon"><i class="fas fa-plus-circle"></i></span>
            </div>
        </div>
        <button class="quick-action-btn" id="quickActionBtn"><i class="fas fa-plus"></i></button>
    </div>

    <!-- Modals (empty containers, filled dynamically) -->
    <div id="serviceModal" class="modal"></div>
    <div id="customerModal" class="modal"></div>
    <div id="userModal" class="modal"></div>
    <div id="manageCustomersModal" class="modal"></div>
    <div id="manageCategoriesModal" class="modal"></div>
    <div id="expenseModal" class="modal"></div>
    <div id="historyModal" class="modal"></div>
    <div id="pickedUpHistoryModal" class="modal"></div>
    <div id="manageStoreInfoModal" class="modal"></div>
    <div id="controlPanelModal" class="modal"></div>
    <div id="passwordPromptModal" class="modal"></div>
    <div id="confirmationModal" class="modal"></div>
    <div id="recapReportModal" class="modal"></div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h3 class="modal-title">Proses Pembayaran</h3><button class="modal-close">&times;</button></div>
            <div class="modal-body">
                <input type="hidden" id="paymentOrderId">
                <div class="text-center mb-3"><p class="mb-0">Sisa Tagihan</p><h2 id="paymentTotal" class="text-primary font-weight-bold" style="color: var(--primary-gradient-2) !important;">Rp 0</h2></div>
                <div class="form-group">
                    <label class="form-label">Metode Pembayaran</label>
                    <select id="paymentMethod" class="form-control"><option value="cash">Tunai</option><option value="transfer">Transfer</option></select>
                </div>
                 <div id="smartPaymentContainer" class="smart-payment-container"></div>
                <div class="form-group"><label class="form-label">Jumlah Pembayaran</label><input type="number" id="paymentAmount" class="form-control" placeholder="Masukkan jumlah" min="0"></div>
                <div id="changeContainer" style="display: none;"><div class="summary-row total-row" style="border-top: 1px solid #ddd;"><span>Kembalian:</span><span id="paymentChange">Rp 0</span></div></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-warning modal-close-btn">Batal</button>
                <button id="completePaymentBtn" class="btn btn-success">Selesaikan Pembayaran</button>
            </div>
        </div>
    </div>
    
    <!-- Status Update Modal -->
    <div id="statusUpdateModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header"><h3 class="modal-title">Update Status Order</h3><button class="modal-close">&times;</button></div>
            <div class="modal-body">
                <input type="hidden" id="statusUpdateOrderId">
                <p>Pilih status baru untuk order <strong id="statusUpdateOrderIdLabel"></strong>:</p>
                <select id="newStatusSelect" class="form-control"></select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-warning modal-close-btn">Batal</button>
                <button id="saveStatusUpdateBtn" class="btn btn-success">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div id="receiptModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header no-print"><h3 class="modal-title">Nota Laundry</h3><button class="modal-close">&times;</button></div>
            <div class="modal-body" id="receiptModalBody" style="background: #f0f2f5; padding: 20px;"></div>
            <div class="modal-footer no-print">
                <button type="button" class="btn btn-warning modal-close-btn">Tutup</button>
                <button class="btn btn-info" id="downloadReceiptPdfBtn"><i class="fas fa-file-pdf"></i> Unduh PDF</button>
                <button class="btn btn-success" id="printReceiptBtn"><i class="fas fa-print"></i> Cetak</button>
            </div>
        </div>
    </div>
    
    <!-- Print Container -->
    <div id="print-container" style="display:none;"></div>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/id.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="main.js"></script>
</body>
</html>
