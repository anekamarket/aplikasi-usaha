<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEM BANTUAN NELAYAN - SITUBONDO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        :root {
            /* Palette Mewah: Deep Ocean Green, Royal Blue, Golden Orange */
            --primary-dark: #00334e;
            --primary-main: #006064; /* Deep Cyan/Green */
            --primary-light: #4dd0e1;
            
            --secondary-dark: #1a237e; /* Deep Blue */
            --secondary-main: #283593;
            
            --accent-color: #ff6f00; /* Amber/Orange */
            --accent-glow: #ffca28;
            
            --bg-light: #f4f7f6;
            --text-dark: #263238;
            
            /* Gradients Luxury */
            --gradient-header: linear-gradient(120deg, #00334e 0%, #006064 50%, #1a237e 100%);
            --gradient-primary: linear-gradient(135deg, #006064, #00838f);
            --gradient-secondary: linear-gradient(135deg, #283593, #3f51b5);
            --gradient-accent: linear-gradient(135deg, #ff6f00, #ff8f00);
            --gradient-gold: linear-gradient(135deg, #ffa000, #ffc107);
            
            /* Shadows */
            --shadow-sm: 0 4px 6px rgba(0,0,0,0.05);
            --shadow-md: 0 8px 15px rgba(0,0,0,0.1);
            --shadow-lg: 0 15px 35px rgba(0,51,78,0.2);
            --shadow-glow: 0 0 15px rgba(77, 208, 225, 0.4);
        }
        
        body {
            background: #f0f4f8;
            font-family: 'Poppins', sans-serif; /* Body font clean */
            min-height: 100vh;
            padding: 15px 0;
            overflow-x: hidden;
            color: var(--text-dark);
        }
        
        h1, h2, h3, h4, h5, h6, .app-title, .section-title {
            font-family: 'Montserrat', sans-serif; /* Header font luxurious/bold */
        }
        
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--shadow-lg);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            z-index: 10;
            border: 1px solid rgba(255,255,255,0.5);
        }
        
        /* HEADER MEWAH */
        .app-header {
            background: var(--gradient-header);
            color: white;
            padding: 40px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-bottom: 5px solid var(--accent-color);
        }
        
        /* Efek Gelombang Halus di Header */
        .app-header::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='rgba(255,255,255,0.05)' fill-opacity='1' d='M0,224L48,213.3C96,203,192,181,288,181.3C384,181,480,203,576,224C672,245,768,267,864,261.3C960,256,1056,224,1152,197.3C1248,171,1344,149,1392,138.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E");
            background-size: cover;
            background-position: bottom;
            pointer-events: none;
            opacity: 0.6;
        }
        
        .app-logo {
            font-size: 3.5rem;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            display: inline-block;
            background: rgba(255,255,255,0.1);
            width: 100px;
            height: 100px;
            line-height: 100px;
            border-radius: 50%;
            box-shadow: 0 0 30px rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: var(--accent-glow);
        }
        
        .app-title {
            font-size: 2rem;
            font-weight: 800;
            margin: 0;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.4);
            letter-spacing: 1px;
            text-transform: uppercase;
            background: linear-gradient(to right, #ffffff, #e0f7fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .app-subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 500;
            letter-spacing: 1px;
            margin-top: 5px;
            color: var(--accent-glow);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        /* SIDEBAR NAVIGATION */
        .col-md-3.col-lg-2 {
            background: #ffffff;
            border-right: 1px solid #e0e0e0;
        }

        .nav-pills .nav-link {
            border-radius: 10px;
            margin-bottom: 10px;
            padding: 14px 18px;
            font-weight: 600;
            color: #546e7a;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            display: flex;
            align-items: center;
            font-size: 0.95rem;
            border: 1px solid transparent;
        }
        
        .nav-pills .nav-link:hover {
            background-color: #e0f7fa;
            color: var(--primary-main);
            transform: translateX(5px);
        }
        
        .nav-pills .nav-link.active {
            background: var(--gradient-primary);
            font-weight: 700;
            box-shadow: var(--shadow-md);
            transform: translateX(5px);
            color: white;
            border: none;
        }
        
        .feature-icon {
            font-size: 1.2rem;
            margin-right: 12px;
            width: 24px;
            text-align: center;
        }
        
        /* CONTENT AREA */
        .section-title {
            border-left: 5px solid var(--accent-color);
            padding-left: 15px;
            margin: 25px 0;
            font-weight: 800;
            color: var(--primary-dark);
            font-size: 1.6rem;
            position: relative;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* BUTTONS */
        .btn {
            border-radius: 8px;
            font-weight: 600;
            letter-spacing: 0.5px;
            padding: 10px 20px;
            text-transform: uppercase;
            font-size: 0.85rem;
            border: none;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--gradient-primary);
            box-shadow: 0 4px 10px rgba(0, 96, 100, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #004d40, #006064);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 96, 100, 0.4);
        }
        
        .btn-success {
            background: var(--gradient-secondary); /* Using secondary blue for 'success' actions to match theme */
            box-shadow: 0 4px 10px rgba(40, 53, 147, 0.3);
        }

        .btn-warning {
            background: var(--gradient-accent);
            color: white;
            box-shadow: 0 4px 10px rgba(255, 111, 0, 0.3);
        }
        
        /* FORM ELEMENTS */
        .form-label {
            font-weight: 600;
            color: var(--primary-dark);
            font-size: 0.9rem;
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            padding: 12px 15px;
            border: 2px solid #eceff1;
            background-color: #fafafa;
            transition: all 0.3s;
            font-size: 0.95rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-main);
            background-color: #fff;
            box-shadow: 0 0 0 4px rgba(0, 96, 100, 0.1);
        }

        /* TABLES */
        .data-table {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid #eceff1;
        }
        
        .data-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1px;
            padding: 15px 10px;
            border: none;
        }
        
        .data-table tr:hover {
            background-color: #e0f7fa !important;
        }

        /* CARDS & STATS */
        .card {
            border-radius: 15px;
            border: none;
            box-shadow: var(--shadow-sm);
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }
        
        .card-header {
            background: var(--gradient-header);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            font-weight: 700;
            padding: 15px 20px;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        .stats-box {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow-sm);
            text-align: center;
            border-bottom: 4px solid transparent;
            transition: all 0.3s;
        }
        
        .stats-box:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
            border-bottom-color: var(--accent-color);
        }
        
        .stats-number {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 10px 0;
        }

        /* LOGIN MODAL LUXURY */
        .login-header {
            background: var(--gradient-header);
            padding: 40px 20px;
            clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%);
        }
        
        .login-icon {
            color: var(--accent-glow);
            text-shadow: 0 0 10px rgba(255,202,40,0.5);
        }
        
        .btn-login {
            background: var(--gradient-gold);
            color: #000;
            font-weight: 800;
            text-transform: uppercase;
        }
        
        .btn-login:hover {
            background: linear-gradient(135deg, #ffc107, #ffca28);
            transform: scale(1.02);
        }

        /* Watermark & Copyright */
        .watermark {
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            letter-spacing: 1px;
            backdrop-filter: blur(5px);
        }
        
        .copyright {
            background: #263238;
            color: #b0bec5;
            margin-top: 20px;
            border-radius: 10px;
        }
        
        /* Floating Action Button */
        .floating-action-btn {
            background: var(--gradient-accent);
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
        }

        /* Responsive */
        @media (max-width: 991.98px) {
            .app-title { font-size: 1.5rem; }
            .app-subtitle { font-size: 0.9rem; }
            .col-md-3.col-lg-2 {
                background: linear-gradient(180deg, #006064, #00334e);
            }
            .nav-pills .nav-link { color: rgba(255,255,255,0.8); }
            .nav-pills .nav-link:hover { color: white; background: rgba(255,255,255,0.1); }
            .nav-pills .nav-link.active { background: var(--accent-color); color: white; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: var(--primary-main); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-dark); }
        
        /* Badge Custom */
        .badge-custom {
            background: var(--gradient-accent);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Loading Spinner Color */
        .spinner-border { color: var(--accent-color); }
    </style>
</head>
<body>
    <div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 20px; overflow: hidden; border: none;">
                <div class="login-header">
                    <div class="login-icon text-center mb-3">
                        <i class="fas fa-shield-alt fa-3x"></i>
                    </div>
                    <h2 class="login-title text-center text-white">AUTHENTICATION</h2>
                    <p class="login-subtitle text-center text-white-50">Sistem Aplikasi Bantuan Barang Pinjam Pakai</p>
                </div>
                <div class="login-body">
                    <form id="loginForm">
                        <div class="mb-3 login-form-group">
                            <label class="form-label login-form-label">
                                <i class="fas fa-key"></i> Kode Keamanan
                            </label>
                            <div class="input-group">
                                <input type="password" class="form-control login-form-control" id="securityCode" placeholder="Masukkan kode akses..." style="padding: 15px;">
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text text-danger login-attempts-count" id="attemptsCount"></div>
                            <div class="login-hint mt-3">
                                <i class="fas fa-lightbulb text-warning"></i> PASSWORD : <strong>Gratis12345</strong>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-login w-100 py-3 shadow-lg" id="loginButton">
                            <span class="login-button-text">MASUK APLIKASI</span>
                            <span class="spinner-border spinner-border-sm d-none" id="loginSpinner"></span>
                        </button>
                    </form>
                    
                    <div class="login-blocked-message d-none" id="blockedMessage">
                        <i class="fas fa-ban me-2"></i>
                        <span id="blockedText">Terlalu banyak percobaan gagal. Silakan coba lagi dalam </span>
                        <span class="login-countdown" id="countdown">30</span> detik.
                    </div>
                    
                    <div class="login-developer-info mt-4">
                        <h6 class="text-center mb-2" style="font-size: 0.8rem; text-transform: uppercase; color: var(--primary-main);">Developer Contact</h6>
                        <div class="login-developer-contact text-center">
                            <p class="mb-1"><i class="fab fa-whatsapp me-2 text-success"></i> <a href="https://wa.me/6285647709114" target="_blank" class="text-decoration-none text-dark">+62 856-4770-9114</a></p>
                            <p><i class="fas fa-envelope me-2 text-danger"></i> <a href="mailto:admin@anekamarket.my.id" class="text-decoration-none text-dark">admin@anekamarket.my.id</a></p>
                        </div>
                    </div>
                    
                    <div class="login-copyright">
                        &copy; 2025 Dinas Peternakan dan Perikanan
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="login-particles"></div>
    
    <div class="app-content-unauthenticated" id="appContent">
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>
        
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <div class="app-container animate-fadeIn">
            <div class="app-header">
                <div class="app-logo">
                    <i class="fas fa-ship"></i>
                </div>
                <h1 class="app-title">SISTEM APLIKASI BANTUAN BARANG PINJAM PAKAI BIDANG PEMBERDAYAAN NELAYAN</h1>
                <p class="app-subtitle">Dinas Peternakan dan Perikanan Kabupaten Situbondo</p>
                <div class="watermark"><i class="fas fa-crown text-warning me-1"></i> Versi Premium</div>
            </div>
            
            <div class="row g-0">
                <div class="col-md-3 col-lg-2 p-4" id="sidebarMenu">
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <button class="nav-link active" id="v-pills-dashboard-tab" data-bs-toggle="pill" data-bs-target="#v-pills-dashboard" type="button" role="tab" aria-controls="v-pills-dashboard" aria-selected="true">
                            <i class="fas fa-chart-line feature-icon"></i> Dashboard
                        </button>
                        <button class="nav-link" id="v-pills-input-tab" data-bs-toggle="pill" data-bs-target="#v-pills-input" type="button" role="tab" aria-controls="v-pills-input" aria-selected="false">
                            <i class="fas fa-pen-nib feature-icon"></i> Input Data
                        </button>
                        <button class="nav-link" id="v-pills-data-tab" data-bs-toggle="pill" data-bs-target="#v-pills-data" type="button" role="tab" aria-controls="v-pills-data" aria-selected="false">
                            <i class="fas fa-table feature-icon"></i> Data Bantuan
                        </button>
                        <button class="nav-link" id="v-pills-filter-tab" data-bs-toggle="pill" data-bs-target="#v-pills-filter" type="button" role="tab" aria-controls="v-pills-filter" aria-selected="false">
                            <i class="fas fa-filter feature-icon"></i> Filter Data
                        </button>
                        <button class="nav-link" id="v-pills-print-tab" data-bs-toggle="pill" data-bs-target="#v-pills-print" type="button" role="tab" aria-controls="v-pills-print" aria-selected="false">
                            <i class="fas fa-print feature-icon"></i> Cetak Laporan
                        </button>
                        <button class="nav-link" id="v-pills-export-tab" data-bs-toggle="pill" data-bs-target="#v-pills-export" type="button" role="tab" aria-controls="v-pills-export" aria-selected="false">
                            <i class="fas fa-file-export feature-icon"></i> Ekspor Data
                        </button>
                        <button class="nav-link" id="v-pills-backup-tab" data-bs-toggle="pill" data-bs-target="#v-pills-backup" type="button" role="tab" aria-controls="v-pills-backup" aria-selected="false">
                            <i class="fas fa-cloud-download-alt feature-icon"></i> Backup & Restore
                        </button>
                        <button class="nav-link" id="v-pills-settings-tab" data-bs-toggle="pill" data-bs-target="#v-pills-settings" type="button" role="tab" aria-controls="v-pills-settings" aria-selected="false">
                            <i class="fas fa-cogs feature-icon"></i> Pengaturan
                        </button>
                        <button class="nav-link" id="btn-reload-repo" type="button">
                            <i class="fas fa-sync-alt feature-icon"></i> Reload Data
                        </button>
                        <button class="nav-link text-danger" id="v-pills-logout-tab" type="button">
                            <i class="fas fa-power-off feature-icon"></i> Keluar
                        </button>
                    </div>
                    
                    <div class="developer-info mt-4">
                        <h6 style="color: var(--primary-main); font-size: 0.8rem; text-transform: uppercase;">Technical Support</h6>
                        <div class="developer-contact">
                            <p><i class="fab fa-whatsapp me-2 text-success"></i> <a href="https://wa.me/6285647709114" target="_blank" class="text-decoration-none text-muted">+62 856-4770-9114</a></p>
                            <p><i class="fas fa-envelope me-2 text-danger"></i> <a href="mailto:admin@anekamarket.my.id" class="text-decoration-none text-muted">admin@anekamarket.my.id</a></p>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-9 col-lg-10 p-5 bg-white">
                    <div class="tab-content" id="v-pills-tabContent">
                        <div class="tab-pane fade show active" id="v-pills-dashboard" role="tabpanel">
                            <h3 class="section-title"><i class="fas fa-tachometer-alt me-2 text-warning"></i> Dashboard Eksekutif</h3>
                            
                            <div class="row">
                                <div class="col-lg-3 col-md-6 mb-4">
                                    <div class="stats-box">
                                        <i class="fas fa-users fa-3x" style="color: var(--primary-main)"></i>
                                        <div class="stats-number" id="totalPenerima">0</div>
                                        <div class="stats-label text-uppercase font-weight-bold text-muted">Total Penerima</div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6 mb-4">
                                    <div class="stats-box">
                                        <i class="fas fa-money-bill-wave fa-3x text-success"></i>
                                        <div class="stats-number" id="totalBantuan">0</div>
                                        <div class="stats-label text-uppercase font-weight-bold text-muted">Total Bantuan Uang</div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6 mb-4">
                                    <div class="stats-box">
                                        <i class="fas fa-calendar-alt fa-3x text-warning"></i>
                                        <div class="stats-number" id="tahunAktif">2025</div>
                                        <div class="stats-label text-uppercase font-weight-bold text-muted">Tahun Anggaran</div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6 mb-4">
                                    <div class="stats-box">
                                        <i class="fas fa-chart-line fa-3x text-info"></i>
                                        <div class="stats-number" id="rataBantuan">0</div>
                                        <div class="stats-label text-uppercase font-weight-bold text-muted">Rata-rata Bantuan</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-4">
                                <div class="col-md-6">
                                    <div class="card h-100">
                                        <div class="card-header">
                                            <i class="fas fa-chart-pie me-2"></i> Distribusi per Kecamatan
                                        </div>
                                        <div class="card-body">
                                            <canvas id="kecamatanChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card h-100">
                                        <div class="card-header">
                                            <i class="fas fa-chart-bar me-2"></i> Tren Bantuan per Tahun
                                        </div>
                                        <div class="card-body">
                                            <canvas id="tahunChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header bg-dark text-white">
                                            <i class="fas fa-history me-2 text-warning"></i> Data Terbaru Masuk
                                        </div>
                                        <div class="card-body p-0">
                                            <div class="table-responsive">
                                                <table class="table table-hover data-table mb-0">
                                                    <thead>
                                                        <tr>
                                                            <th>Tanggal</th>
                                                            <th>Nama Penerima</th>
                                                            <th>Desa</th>
                                                            <th>Jenis Bantuan</th>
                                                            <th>Jumlah</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="recentData">
                                                        <tr>
                                                            <td colspan="5" class="text-center">Tidak ada data</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-input" role="tabpanel">
                            <h3 class="section-title"><i class="fas fa-pencil-alt me-2 text-primary"></i> Input Data Bantuan</h3>
                            
                            <div class="card border-primary">
                                <div class="card-header bg-primary text-white">
                                    <i class="fas fa-file-signature me-2"></i> Formulir Pendataan Nelayan
                                </div>
                                <div class="card-body">
                                    <form id="inputForm" novalidate>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="nama" class="form-label">
                                                    <i class="fas fa-user me-1 text-info"></i> Nama Penerima
                                                </label>
                                                <input type="text" class="form-control" id="nama" required placeholder="Nama Lengkap">
                                                <div class="error-message" id="namaError">Nama penerima wajib diisi.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="nik" class="form-label">
                                                    <i class="fas fa-id-card me-1 text-info"></i> NIK
                                                </label>
                                                <input type="text" class="form-control" id="nik" required maxlength="16" placeholder="16 Digit NIK">
                                                <div class="error-message" id="nikError">NIK wajib diisi dan harus 16 digit angka.</div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="whatsapp" class="form-label">
                                                    <i class="fab fa-whatsapp me-1 text-success"></i> Nomor WhatsApp
                                                </label>
                                                <div class="whatsapp-input-container">
                                                    <span class="whatsapp-prefix">+62</span>
                                                    <input type="tel" class="form-control whatsapp-input" id="whatsapp" placeholder="8xx-xxxx-xxxx" required>
                                                </div>
                                                <div class="error-message" id="whatsappError">Nomor WhatsApp wajib diisi.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="namaKelompok" class="form-label">
                                                    <i class="fas fa-users me-1 text-info"></i> Nama Kelompok
                                                </label>
                                                <div class="input-group">
                                                    <input type="text" class="form-control" id="namaKelompok" placeholder="Opsional (Kosongkan jika individu)">
                                                    <button type="button" class="btn btn-secondary" id="btnBukanKelompok">
                                                        Individu
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="jabatan" class="form-label">
                                                    <i class="fas fa-user-tag me-1 text-info"></i> Jabatan
                                                </label>
                                                <select class="form-select" id="jabatan">
                                                    <option value="Individu" selected>Individu</option>
                                                    <option value="Ketua Kelompok">Ketua Kelompok</option>
                                                    <option value="Sekretaris">Sekretaris</option>
                                                    <option value="Bendahara">Bendahara</option>
                                                    <option value="Pengawas">Pengawas</option>
                                                    <option value="Anggota">Anggota</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="tahunAnggaran" class="form-label">
                                                    <i class="fas fa-calendar me-1 text-info"></i> Tahun Anggaran
                                                </label>
                                                <select class="form-select" id="tahunAnggaran">
                                                    </select>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="kecamatan" class="form-label">
                                                    <i class="fas fa-map-marker-alt me-1 text-danger"></i> Kecamatan
                                                </label>
                                                <select class="form-select" id="kecamatan" required>
                                                    <option value="">Pilih Kecamatan</option>
                                                    </select>
                                                <div class="error-message" id="kecamatanError">Kecamatan wajib dipilih.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="desa" class="form-label">
                                                    <i class="fas fa-map-marked-alt me-1 text-danger"></i> Desa
                                                </label>
                                                <select class="form-select" id="desa" required>
                                                    <option value="">Pilih Desa</option>
                                                    </select>
                                                <div class="error-message" id="desaError">Desa wajib dipilih.</div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="alamat" class="form-label">
                                                    <i class="fas fa-home me-1 text-info"></i> Alamat Lengkap
                                                </label>
                                                <textarea class="form-control" id="alamat" rows="1" placeholder="Nama Jalan, RT/RW"></textarea>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="jenisBantuan" class="form-label">
                                                    <i class="fas fa-gift me-1 text-warning"></i> Jenis Bantuan
                                                </label>
                                                <select class="form-select" id="jenisBantuan">
                                                    <option value="Uang">Uang</option>
                                                    <option value="Barang">Barang (Mesin/Alat)</option>
                                                    <option value="Jasa">Jasa</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="namaBantuan" class="form-label">
                                                    <i class="fas fa-box-open me-1 text-warning"></i> Rincian Barang/Bantuan
                                                </label>
                                                <input type="text" class="form-control" id="namaBantuan" placeholder="Contoh: Mesin Kapal 5PK, Jaring" required>
                                                <div class="error-message" id="namaBantuanError">Nama bantuan wajib diisi.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="jumlahBantuan" class="form-label">
                                                    <i class="fas fa-coins me-1 text-warning"></i> Jumlah/Nominal
                                                </label>
                                                <div class="input-group">
                                                    <input type="text" class="form-control" id="jumlahBantuan" placeholder="0" required>
                                                    <select class="form-select" id="satuanBantuan" style="max-width: 120px;">
                                                        <option value="Rupiah">Rupiah</option>
                                                        <option value="Unit">Unit</option>
                                                        <option value="Paket">Paket</option>
                                                    </select>
                                                </div>
                                                <div class="error-message" id="jumlahBantuanError">Jumlah bantuan wajib diisi.</div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="tanggalTerima" class="form-label">
                                                    <i class="fas fa-calendar-check me-1 text-success"></i> Tanggal Penyerahan
                                                </label>
                                                <input type="date" class="form-control" id="tanggalTerima" required>
                                                <div class="error-message" id="tanggalTerimaError">Tanggal menerima wajib diisi.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="namaPetugas" class="form-label">
                                                    <i class="fas fa-user-tie me-1 text-primary"></i> Petugas Penanggung Jawab
                                                </label>
                                                <input type="text" class="form-control" id="namaPetugas" placeholder="Nama Petugas Dinas" required>
                                                <div class="error-message" id="namaPetugasError">Nama petugas wajib diisi.</div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="driveLink" class="form-label">
                                                    <i class="fab fa-google-drive me-1 text-success"></i> Link Bukti (Google Drive)
                                                </label>
                                                <input type="url" class="form-control" id="driveLink" placeholder="https://drive.google.com/...">
                                                <div class="error-message" id="driveLinkError">Harap masukkan URL Google Drive yang valid.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="kodeValidasi" class="form-label">
                                                    <i class="fas fa-qrcode me-1 text-dark"></i> Kode Validasi
                                                </label>
                                                <div class="input-group">
                                                    <input type="text" class="form-control bg-light" id="kodeValidasi" placeholder="Generate setelah isi NIK" readonly required>
                                                    <button type="button" class="btn btn-warning text-white" id="generateKodeBtn">
                                                        <i class="fas fa-cog"></i> Generate
                                                    </button>
                                                </div>
                                                <div class="error-message" id="kodeValidasiError">Kode validasi wajib digenerate.</div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-12">
                                                <label for="keterangan" class="form-label">
                                                    <i class="fas fa-sticky-note me-1 text-muted"></i> Keterangan Tambahan
                                                </label>
                                                <textarea class="form-control" id="keterangan" rows="2" placeholder="Catatan khusus..."></textarea>
                                            </div>
                                        </div>
                                        
                                        <div class="d-flex justify-content-end mt-4 pt-3 border-top">
                                            <button type="reset" class="btn btn-light border me-2">
                                                <i class="fas fa-undo me-1"></i> Reset Formulir
                                            </button>
                                            <button type="submit" class="btn btn-primary px-4">
                                                <i class="fas fa-save me-1"></i> SIMPAN DATA
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-data" role="tabpanel">
                            <h3 class="section-title"><i class="fas fa-database me-2 text-primary"></i> Database Bantuan</h3>
                            
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center bg-white text-dark border-bottom">
                                    <div class="font-weight-bold">
                                        <i class="fas fa-list me-2 text-primary"></i> Daftar Penerima Bantuan
                                    </div>
                                    <div class="input-group shadow-sm" style="max-width: 300px;">
                                        <span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-muted"></i></span>
                                        <input type="text" class="form-control border-start-0 ps-0" id="searchData" placeholder="Cari Nama/NIK/Desa...">
                                        <button class="btn btn-outline-secondary" id="clearSearchBtn">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table table-hover data-table mb-0" id="dataTable">
                                            <thead>
                                                <tr>
                                                    <th>No</th>
                                                    <th>Nama</th>
                                                    <th>NIK</th>
                                                    <th>WhatsApp</th>
                                                    <th>Kelompok</th>
                                                    <th>Jabatan</th>
                                                    <th>Tahun</th>
                                                    <th>Kecamatan</th>
                                                    <th>Desa</th>
                                                    <th>Jenis</th>
                                                    <th>Barang/Bantuan</th>
                                                    <th>Jumlah</th>
                                                    <th>Tanggal</th>
                                                    <th>Petugas</th>
                                                    <th>Bukti</th>
                                                    <th>Kode</th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="dataTableBody">
                                                <tr>
                                                    <td colspan="17" class="text-center py-5 text-muted">
                                                        <i class="fas fa-inbox fa-3x mb-3 d-block"></i>
                                                        Belum ada data tersedia
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between align-items-center p-3 border-top bg-light">
                                        <div class="text-muted small" id="tableInfo">
                                            Menampilkan 0 dari 0 data
                                        </div>
                                        <nav>
                                            <ul class="pagination pagination-sm mb-0 shadow-sm" id="pagination">
                                                </ul>
                                        </nav>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-filter" role="tabpanel">
                            <h3 class="section-title"><i class="fas fa-filter me-2 text-primary"></i> Filter & Pencarian Lanjutan</h3>
                            
                            <div class="card mb-4 border-info">
                                <div class="card-header bg-info text-white">
                                    <i class="fas fa-sliders-h me-2"></i> Parameter Filter
                                </div>
                                <div class="card-body bg-light">
                                    <div class="row mb-3">
                                        <div class="col-md-3">
                                            <label for="filterTahun" class="form-label">Tahun Anggaran</label>
                                            <select class="form-select" id="filterTahun">
                                                <option value="">Semua Tahun</option>
                                                </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="filterKecamatan" class="form-label">Kecamatan</label>
                                            <select class="form-select" id="filterKecamatan">
                                                <option value="">Semua Kecamatan</option>
                                                </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="filterDesa" class="form-label">Desa</label>
                                            <select class="form-select" id="filterDesa">
                                                <option value="">Semua Desa</option>
                                                </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="filterJenis" class="form-label">Jenis Bantuan</label>
                                            <select class="form-select" id="filterJenis">
                                                <option value="">Semua Jenis</option>
                                                <option value="Uang">Uang</option>
                                                <option value="Barang">Barang</option>
                                                <option value="Jasa">Jasa</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="d-flex justify-content-end">
                                        <button type="button" class="btn btn-secondary me-2" id="resetFilterBtn">
                                            <i class="fas fa-undo me-1"></i> Reset
                                        </button>
                                        <button type="button" class="btn btn-primary" id="applyFilterBtn">
                                            <i class="fas fa-check-circle me-1"></i> Terapkan Filter
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center bg-white">
                                    <div class="font-weight-bold text-primary">
                                        <i class="fas fa-list-alt me-2"></i> Hasil Filter
                                    </div>
                                    <span class="badge bg-primary rounded-pill px-3 py-2" id="filterResultCount">0 Data Ditemukan</span>
                                </div>
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table table-hover data-table mb-0" id="filterTable">
                                            <thead>
                                                <tr>
                                                    <th>No</th>
                                                    <th>Nama</th>
                                                    <th>NIK</th>
                                                    <th>WhatsApp</th>
                                                    <th>Kelompok</th>
                                                    <th>Jabatan</th>
                                                    <th>Tahun</th>
                                                    <th>Kecamatan</th>
                                                    <th>Desa</th>
                                                    <th>Jenis</th>
                                                    <th>Barang/Bantuan</th>
                                                    <th>Jumlah</th>
                                                    <th>Tanggal</th>
                                                    <th>Petugas</th>
                                                    <th>Bukti</th>
                                                    <th>Kode</th>
                                                </tr>
                                            </thead>
                                            <tbody id="filterTableBody">
                                                <tr>
                                                    <td colspan="16" class="text-center py-5 text-muted">Silakan terapkan filter di atas</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-print" role="tabpanel">
                            <h3 class="section-title"><i class="fas fa-print me-2 text-primary"></i> Cetak Laporan Resmi</h3>
                            
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="card mb-4">
                                        <div class="card-header bg-dark text-white">
                                            <i class="fas fa-cog me-2"></i> Konfigurasi Laporan
                                        </div>
                                        <div class="card-body">
                                            <div class="control-panel p-3 bg-light rounded mb-4 border">
                                                <h6 class="control-title text-primary font-weight-bold border-bottom pb-2 mb-3">1. Filter Data Laporan</h6>
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <label for="printTahun" class="form-label">Tahun Anggaran</label>
                                                        <select class="form-select" id="printTahun">
                                                            <option value="">Semua Tahun</option>
                                                            </select>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <label for="printKecamatan" class="form-label">Wilayah Kecamatan</label>
                                                        <select class="form-select" id="printKecamatan">
                                                            <option value="">Semua Kecamatan</option>
                                                            </select>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <label for="printJenis" class="form-label">Kategori Bantuan</label>
                                                        <select class="form-select" id="printJenis">
                                                            <option value="">Semua Jenis</option>
                                                            <option value="Uang">Uang</option>
                                                            <option value="Barang">Barang</option>
                                                            <option value="Jasa">Jasa</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <h6 class="control-title text-primary font-weight-bold mb-3">2. Pilih Metode Output</h6>
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <div class="card h-100 border-info shadow-sm hover-shadow">
                                                        <div class="card-body text-center d-flex flex-column justify-content-center p-4">
                                                            <div class="mb-3 text-info">
                                                                <i class="fas fa-eye fa-4x"></i>
                                                            </div>
                                                            <h5 class="font-weight-bold">Pratinjau (Preview)</h5>
                                                            <p class="text-muted small">Lihat tampilan laporan di layar sebelum mencetak.</p>
                                                            <button class="btn btn-info text-white mt-auto w-100" id="previewBtn">
                                                                <i class="fas fa-search me-1"></i> Buka Pratinjau
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="card h-100 border-danger shadow-sm hover-shadow">
                                                        <div class="card-body text-center d-flex flex-column justify-content-center p-4">
                                                            <div class="mb-3 text-danger">
                                                                <i class="fas fa-file-pdf fa-4x"></i>
                                                            </div>
                                                            <h5 class="font-weight-bold">Unduh PDF</h5>
                                                            <p class="text-muted small">Simpan laporan resmi dalam format PDF siap cetak.</p>
                                                            <button class="btn btn-danger mt-auto w-100" id="printPdfBtn">
                                                                <i class="fas fa-download me-1"></i> Download PDF
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-export" role="tabpanel">
                            <h3 class="section-title"><i class="fas fa-file-export me-2 text-primary"></i> Ekspor Data Digital</h3>
                            
                            <div class="card">
                                <div class="card-header bg-success text-white">
                                    <i class="fas fa-cloud-download-alt me-2"></i> Pusat Unduhan Data
                                </div>
                                <div class="card-body">
                                    <div class="control-panel p-3 bg-light rounded mb-4 border">
                                        <h6 class="control-title text-success mb-3">Filter Ekspor (Opsional)</h6>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label for="exportTahun" class="form-label">Tahun</label>
                                                <select class="form-select" id="exportTahun">
                                                    <option value="">Semua Tahun</option>
                                                    </select>
                                            </div>
                                            <div class="col-md-4">
                                                <label for="exportKecamatan" class="form-label">Kecamatan</label>
                                                <select class="form-select" id="exportKecamatan">
                                                    <option value="">Semua Kecamatan</option>
                                                    </select>
                                            </div>
                                            <div class="col-md-4">
                                                <label for="exportJenis" class="form-label">Jenis</label>
                                                <select class="form-select" id="exportJenis">
                                                    <option value="">Semua Jenis</option>
                                                    <option value="Uang">Uang</option>
                                                    <option value="Barang">Barang</option>
                                                    <option value="Jasa">Jasa</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <div class="card border-success h-100 text-center p-3 hover-shadow">
                                                <i class="fas fa-file-excel fa-3x text-success mb-3"></i>
                                                <h5 class="font-weight-bold">Excel (.xlsx)</h5>
                                                <button class="btn btn-success w-100 mt-2" id="exportExcelBtn">
                                                    <i class="fas fa-download"></i> Unduh
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card border-info h-100 text-center p-3 hover-shadow">
                                                <i class="fas fa-file-csv fa-3x text-info mb-3"></i>
                                                <h5 class="font-weight-bold">CSV (.csv)</h5>
                                                <button class="btn btn-info text-white w-100 mt-2" id="exportCsvBtn">
                                                    <i class="fas fa-download"></i> Unduh
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card border-warning h-100 text-center p-3 hover-shadow">
                                                <i class="fas fa-file-code fa-3x text-warning mb-3"></i>
                                                <h5 class="font-weight-bold">JSON (.json)</h5>
                                                <button class="btn btn-warning text-white w-100 mt-2" id="exportJsonBtn">
                                                    <i class="fas fa-download"></i> Unduh
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card border-danger h-100 text-center p-3 hover-shadow">
                                                <i class="fas fa-file-pdf fa-3x text-danger mb-3"></i>
                                                <h5 class="font-weight-bold">PDF (.pdf)</h5>
                                                <button class="btn btn-danger w-100 mt-2" id="exportPdfBtn">
                                                    <i class="fas fa-download"></i> Unduh
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-backup" role="tabpanel">
                            <h3 class="section-title"><i class="fas fa-database me-2 text-primary"></i> Manajemen Database</h3>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card h-100 border-primary shadow-sm">
                                        <div class="card-header bg-primary text-white">
                                            <i class="fas fa-download me-2"></i> Backup Data (Aman)
                                        </div>
                                        <div class="card-body text-center p-4">
                                            <div class="bg-light rounded-circle d-inline-flex p-4 mb-3">
                                                <i class="fas fa-shield-alt fa-4x text-primary"></i>
                                            </div>
                                            <h5 class="font-weight-bold">Simpan Cadangan Data</h5>
                                            <p class="text-muted">Unduh file backup terenkripsi ke komputer Anda.</p>
                                            <div class="mb-3 text-start">
                                                <label for="backupFileName" class="form-label small">Nama File Backup</label>
                                                <input type="text" class="form-control" id="backupFileName" value="backup-nelayan-secure">
                                            </div>
                                            <button class="btn btn-primary w-100 py-2" id="backupDataBtn">
                                                <i class="fas fa-download me-2"></i> PROSES BACKUP
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card h-100 border-success shadow-sm">
                                        <div class="card-header bg-success text-white">
                                            <i class="fas fa-upload me-2"></i> Restore Data
                                        </div>
                                        <div class="card-body text-center p-4">
                                            <div class="bg-light rounded-circle d-inline-flex p-4 mb-3">
                                                <i class="fas fa-sync-alt fa-4x text-success"></i>
                                            </div>
                                            <h5 class="font-weight-bold">Pulihkan Data</h5>
                                            <p class="text-muted">Kembalikan data dari file backup sebelumnya.</p>
                                            <div class="mb-3">
                                                <input type="file" class="form-control" id="restoreFileInput" accept=".json">
                                            </div>
                                            <button class="btn btn-success w-100 py-2" id="restoreDataBtn" disabled>
                                                <i class="fas fa-upload me-2"></i> RESTORE SEKARANG
                                            </button>
                                            <div class="alert alert-warning mt-3 py-2 small">
                                                <i class="fas fa-exclamation-triangle me-1"></i> Data saat ini akan tertimpa!
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-4 border-danger">
                                <div class="card-header bg-danger text-white">
                                    <i class="fas fa-radiation me-2"></i> Zona Berbahaya
                                </div>
                                <div class="card-body d-flex justify-content-between align-items-center flex-wrap p-4">
                                    <div>
                                        <h5 class="text-danger font-weight-bold mb-1">Reset Total Aplikasi</h5>
                                        <p class="text-muted mb-0">Menghapus semua data database secara permanen. Tindakan ini tidak dapat dibatalkan.</p>
                                    </div>
                                    <button class="btn btn-outline-danger mt-2 mt-md-0" id="resetDataBtn" data-bs-toggle="modal" data-bs-target="#confirmResetModal">
                                        <i class="fas fa-trash-alt me-2"></i> HAPUS SEMUA DATA
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-settings" role="tabpanel">
                            <h3 class="section-title"><i class="fas fa-cogs me-2 text-primary"></i> Konfigurasi Sistem</h3>
                            
                            <div class="card mb-4">
                                <div class="card-header bg-dark text-white">
                                    <i class="fas fa-sliders-h me-2"></i> Pengaturan Umum
                                </div>
                                <div class="card-body">
                                    <form id="settingsForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="appName" class="form-label">Nama Aplikasi</label>
                                                <input type="text" class="form-control" id="appName" value="SISTEM BANTUAN NELAYAN">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="appSubtitle" class="form-label">Subjudul Instansi</label>
                                                <input type="text" class="form-control" id="appSubtitle" value="Dinas Peternakan dan Perikanan Kab. Situbondo">
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="defaultTahun" class="form-label">Tahun Default</label>
                                                <select class="form-select" id="defaultTahun">
                                                    </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="itemsPerPage" class="form-label">Tampilan Data per Halaman</label>
                                                <select class="form-select" id="itemsPerPage">
                                                    <option value="10">10 Baris</option>
                                                    <option value="25">25 Baris</option>
                                                    <option value="50">50 Baris</option>
                                                    <option value="100">100 Baris</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="settingSecurityCode" class="form-label">Ubah Kode Akses (Password)</label>
                                                <input type="password" class="form-control" id="settingSecurityCode" placeholder="Biarkan kosong jika tidak ingin mengubah">
                                                <div class="form-text text-muted"><i class="fas fa-info-circle"></i> Default: Gratis12345</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="backupInterval" class="form-label">Backup Otomatis</label>
                                                <select class="form-select" id="backupInterval" disabled>
                                                    <option value="0">Fitur Segera Hadir</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="form-check form-switch mb-3 p-3 bg-light rounded border">
                                            <input class="form-check-input" type="checkbox" id="notifications" checked>
                                            <label class="form-check-label fw-bold" for="notifications">Aktifkan Notifikasi Sistem</label>
                                        </div>
                                        
                                        <div class="d-flex justify-content-end">
                                            <button type="submit" class="btn btn-primary px-4">
                                                <i class="fas fa-save me-2"></i> Simpan Konfigurasi
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header bg-secondary text-white">
                                    <i class="fas fa-info-circle me-2"></i> Informasi Sistem
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Versi Aplikasi
                                                    <span class="badge bg-primary rounded-pill">3.0.0 (Premium)</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Total Database
                                                    <span class="badge bg-info rounded-pill" id="settingsDataCount">0 Record</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Backup Terakhir
                                                    <span class="badge bg-secondary rounded-pill" id="lastBackupDate">-</span>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="col-md-6">
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Browser
                                                    <span class="badge bg-success rounded-pill" id="browserInfo">-</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Penyimpanan Lokal
                                                    <span class="badge bg-warning text-dark rounded-pill" id="storageInfo">-</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Status Sistem
                                                    <span class="badge bg-success rounded-pill" id="appStatus">Online & Stabil</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="copyright text-center py-3">
                &copy; 2025 Bidang Pemberdayaan Nelayan - Dinas Peternakan dan Perikanan Kab. Situbondo
            </div>
        </div>
        
        <div class="floating-action-btn rounded-circle shadow-lg d-flex align-items-center justify-content-center text-white position-fixed bottom-0 end-0 m-4 cursor-pointer" id="fabBtn" title="Tambah Data Baru" style="z-index: 1000; cursor: pointer;">
            <i class="fas fa-plus"></i>
        </div>
        
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div class="toast notification-toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="5000">
                <div class="toast-header">
                    <strong class="me-auto" id="toastTitle">Notification</strong>
                    <small>Baru saja</small>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body" id="toastMessage">
                    </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="confirmResetModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-danger">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-exclamation-triangle me-2"></i> Konfirmasi Penghapusan Total
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center p-4">
                    <i class="fas fa-skull-crossbones fa-3x text-danger mb-3"></i>
                    <p class="lead">Apakah Anda benar-benar yakin?</p>
                    <p class="text-danger small"><strong>PERINGATAN KERAS:</strong> Semua data nelayan dan bantuan akan hilang selamanya. Backup data terlebih dahulu!</p>
                    <p class="mt-3">Ketik kata <strong>RESET</strong> untuk konfirmasi:</p>
                    <input type="text" class="form-control text-center border-danger" id="resetConfirmationInput" placeholder="Ketik RESET di sini">
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batalkan</button>
                    <button type="button" class="btn btn-danger font-weight-bold" id="confirmResetBtn" disabled>YA, HAPUS SEMUA DATA</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="previewModalTitle">Pratinjau Laporan</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="previewContent" class="p-3">
                        </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-primary" id="printFromPreviewBtn">
                        <i class="fas fa-print me-1"></i> Cetak Halaman Ini
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.id.min.js"></script>
    
    <script>
        // --- GLOBAL VARIABLES & CONSTANTS ---
        let appData = [];
        let appSettings = {
            securityCode: 'Gratis12345',
            itemsPerPage: 25,
            notifications: true,
            appName: 'SISTEM BANTUAN NELAYAN',
            appSubtitle: 'Dinas Peternakan dan Perikanan Kabupaten Situbondo',
            defaultTahun: new Date().getFullYear(),
            lastBackupDate: '-'
        };
        let currentPage = 1;
        let filteredData = [];
        let isFilterActive = false;
        let loginAttempts = 0;
        let isBlocked = false;
        let blockTimeout;
        let generatedCodes = {};
        
        const kecamatanList = [
            "Arjasa", "Asembagus", "Banyuglugur", "Banyuputih", "Besuki", 
            "Bungatan", "Jangkar", "Jatibanteng", "Kapongan", "Kendit", 
            "Mangaran", "Mlandingan", "Panarukan", "Panji", "Situbondo", 
            "Suboh", "Sumbermalang"
        ];
        
        const desaList = [
            "Agel", "Alas Bayur", "Alasmalang", "Alastengah", "Arjasa", "Ardirejo", "Asembagus", 
            "Awar-awar", "Awang-awang", "Baderan", "Balung", "Bantal", "Battal", "Bayeman", "Besuki", "Bletok", "Blimbing", "Bloro", "Buduan", "Bugeman", "Bungatan", 
            "Campoan", "Cemara", "Curah Cottok", "Curah Jeru", "Curah Kalak", "Curah Suri", "Curah Tatal", "Dawuhan", "Demung", "Duwet", "Gadingan", "Gebangan", 
            "Gelung", "Gudang", "Gunung Malang", "Gunung Putri", "Jangkar", "Jatisari", "Jatibanteng", "Jetis", "Juglangan", "Kalianget", "Kalibagor", "Kalimas", 
            "Kalirejo", "Kalisari", "Kandang", "Kayu Putih", "Kayumas", "Kedungdowo", "Kedunglo", "Kembangsari", "Ketah", "Ketawan", "Kilensari", "Klampokan", 
            "Klatakan", "Kotakan", "Kumbangsari", "Kukusan", "Lamongan", "Landangan", "Langkap", "Lebeng", "Lubawang", "Mangaran", "Mimbaan", "Mlandingan Kulon", 
            "Mlandingan Wetan", "Mojodungkol", "Mojosari", "Olean", "Palangan", "Panarukan", "Panji Kidul", "Panji Lor", "Parante", "Pasir Putih", "Patemon", 
            "Patokan", "Paowan", "Peleyan", "Pesisir", "Pesanggrahan", "Pategalan", "Plalangan", "Pokaan", "Rajekwesi", "Seletreng", "Selobanteng", 
            "Selomukti", "Selowogo", "Semambung", "Semiring", "Sliwung", "Sopet", "Sumber Pinang", "Sumberanyar", "Sumberargo", "Sumberkolak", "Sumberejo", 
            "Sumbertengah", "Sumberwaru", "Tamankursi", "Tamansari", "Taman", "Talkandang", "Tanjung Glugur", "Tanjung Kamal", "Tanjung Pecinan", "Tambak Ukir", 
            "Telempong", "Tenggir", "Tepos", "Tokelan", "Tlogosari", "Trigonco", "Trebungan", "Widoropayung", "Wonokoyo", "Wonorejo", "Wringinanom"
        ].sort();
        
        
        // --- APPLICATION LIFECYCLE ---
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();
        });
        
        function initializeApp() {
            loadSettings();
            loadData();
            
            fillYearDropdowns();
            fillKecamatanDropdown();
            fillDesaDropdown();
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggalTerima').value = today;
            
            initializeCharts();
            setupBrowserInfo();
            updateDashboard();
            applySettingsToUI();
        }

        // --- SETUP & INITIALIZATION ---
        function setupEventListeners() {
            // Login
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.querySelector('.toggle-password').addEventListener('click', togglePasswordVisibility);
            
            // Main Input Form
            document.getElementById('inputForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('inputForm').addEventListener('reset', resetForm);
            document.getElementById('btnBukanKelompok').addEventListener('click', setBukanKelompok);
            document.getElementById('generateKodeBtn').addEventListener('click', generateKodeValidasi);
            document.getElementById('jabatan').addEventListener('change', handleJabatanChange);
            document.getElementById('nik').addEventListener('input', () => {
                document.getElementById('kodeValidasi').value = ''; // Reset kode jika NIK diubah
            });

            // Form Live Validation
            ['nama', 'nik', 'whatsapp', 'namaPetugas', 'namaBantuan', 'jumlahBantuan', 'driveLink', 'kodeValidasi', 'kecamatan', 'desa', 'tanggalTerima'].forEach(id => {
                document.getElementById(id).addEventListener('input', () => clearError(id));
            });
            
            // Data Table
            document.getElementById('searchData').addEventListener('input', handleSearch);
            document.getElementById('clearSearchBtn').addEventListener('click', clearSearch);
            
            // Filter
            document.getElementById('applyFilterBtn').addEventListener('click', applyFilter);
            document.getElementById('resetFilterBtn').addEventListener('click', resetFilter);
            
            // Print & Export
            document.getElementById('printPdfBtn').addEventListener('click', printToPdf);
            document.getElementById('previewBtn').addEventListener('click', showPreview);
            document.getElementById('exportExcelBtn').addEventListener('click', () => exportData('excel'));
            document.getElementById('exportCsvBtn').addEventListener('click', () => exportData('csv'));
            document.getElementById('exportJsonBtn').addEventListener('click', () => exportData('json'));
            document.getElementById('exportPdfBtn').addEventListener('click', () => exportData('pdf'));
            
            // Backup, Restore, Reset
            document.getElementById('backupDataBtn').addEventListener('click', backupData);
            document.getElementById('restoreFileInput').addEventListener('change', enableRestoreButton);
            document.getElementById('restoreDataBtn').addEventListener('click', restoreData);
            document.getElementById('resetConfirmationInput').addEventListener('input', enableResetButton);
            document.getElementById('confirmResetBtn').addEventListener('click', resetData);
            
            // Settings
            document.getElementById('settingsForm').addEventListener('submit', handleSaveSettings);
            
            // UI/UX Helpers
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);
            document.getElementById('sidebarOverlay').addEventListener('click', toggleMobileMenu);
            document.getElementById('fabBtn').addEventListener('click', () => document.getElementById('v-pills-input-tab').click());
            document.getElementById('jenisBantuan').addEventListener('change', updateSatuanBantuan);
            document.getElementById('printFromPreviewBtn').addEventListener('click', () => window.print());
            document.getElementById('v-pills-logout-tab').addEventListener('click', logout);
            
            // Event listener untuk reload data dari repo
            document.getElementById('btn-reload-repo').addEventListener('click', handleReloadFromRepo);

            // Listener untuk backup otomatis saat menutup/merefresh halaman
            window.addEventListener('beforeunload', autoBackupData);
        }
        
        function fillYearDropdowns() {
            const yearSelects = ['tahunAnggaran', 'filterTahun', 'printTahun', 'exportTahun', 'defaultTahun'];
            const currentYear = new Date().getFullYear();

            yearSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '';
                
                if (!['tahunAnggaran', 'defaultTahun'].includes(selectId)) {
                    select.add(new Option('Semua Tahun', ''));
                }
                
                for (let year = 2020; year <= 2090; year++) {
                    select.add(new Option(year, year));
                }
                
                select.value = (selectId === 'tahunAnggaran') ? currentYear : (selectId === 'defaultTahun' ? appSettings.defaultTahun : '');
            });
        }
        
        function fillKecamatanDropdown() {
            ['kecamatan', 'filterKecamatan', 'printKecamatan', 'exportKecamatan'].forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '';
                const defaultText = selectId === 'kecamatan' ? 'Pilih Kecamatan' : 'Semua Kecamatan';
                select.add(new Option(defaultText, ''));
                kecamatanList.forEach(kec => select.add(new Option(kec, kec)));
            });
        }
        
        function fillDesaDropdown() {
            ['desa', 'filterDesa'].forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '';
                const defaultText = selectId === 'desa' ? 'Pilih Desa' : 'Semua Desa';
                select.add(new Option(defaultText, ''));
                desaList.forEach(desa => select.add(new Option(desa, desa)));
            });
        }

        // --- AUTHENTICATION ---
        function handleLogin(e) {
            e.preventDefault();
            if (isBlocked) return showNotification('Akses diblokir sementara karena terlalu banyak percobaan.', 'error');
            
            const securityCodeInput = document.getElementById('securityCode').value;
            const loginButton = document.getElementById('loginButton');
            
            loginButton.disabled = true;
            document.getElementById('loginSpinner').classList.remove('d-none');
            document.querySelector('.login-button-text').textContent = 'Memverifikasi...';
            
            setTimeout(() => {
                if (securityCodeInput === appSettings.securityCode) {
                    const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                    if (loginModal) loginModal.hide();
                    
                    document.getElementById('appContent').style.display = 'block';
                    loginAttempts = 0;
                    updateAttemptsCount();
                    showNotification('Login berhasil! Selamat datang Admin.', 'success');
                } else {
                    loginAttempts++;
                    updateAttemptsCount();
                    
                    const loginForm = document.getElementById('loginForm');
                    loginForm.classList.add('login-shake');
                    setTimeout(() => loginForm.classList.remove('login-shake'), 600);
                    
                    if (loginAttempts >= 3) {
                        blockAccess();
                    } else {
                        showNotification(`Kode keamanan salah. Sisa percobaan: ${3 - loginAttempts}.`, 'error');
                    }
                }

                loginButton.disabled = false;
                document.getElementById('loginSpinner').classList.add('d-none');
                document.querySelector('.login-button-text').textContent = 'MASUK APLIKASI';
            }, 800);
        }
        
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('securityCode');
            const icon = this.querySelector('i');
            const isPassword = passwordInput.type === 'password';
            passwordInput.type = isPassword ? 'text' : 'password';
            icon.classList.toggle('fa-eye', !isPassword);
            icon.classList.toggle('fa-eye-slash', isPassword);
        }
        
        function updateAttemptsCount() {
            const attemptsEl = document.getElementById('attemptsCount');
            const blockedMessage = document.getElementById('blockedMessage');
            
            attemptsEl.style.display = loginAttempts > 0 && !isBlocked ? 'block' : 'none';
            attemptsEl.textContent = `Percobaan gagal: ${loginAttempts}/3`;
            blockedMessage.classList.toggle('d-none', !isBlocked);
        }
        
        function blockAccess() {
            isBlocked = true;
            updateAttemptsCount();
            showNotification('Akses diblokir selama 30 detik.', 'error');
            
            let countdown = 30;
            const countdownElement = document.getElementById('countdown');
            countdownElement.textContent = countdown;
            
            blockTimeout = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                if (countdown <= 0) {
                    clearInterval(blockTimeout);
                    isBlocked = false;
                    loginAttempts = 0;
                    updateAttemptsCount();
                }
            }, 1000);
        }
        
        function logout() {
            autoBackupData();
            
            if (confirm('Apakah Anda yakin ingin keluar dari aplikasi?')) {
                document.getElementById('appContent').style.display = 'none';
                document.getElementById('securityCode').value = '';
                new bootstrap.Modal(document.getElementById('loginModal')).show();
                showNotification('Anda telah berhasil logout.', 'info');
            }
        }
        
        // --- FORM HANDLING & VALIDATION ---
        function handleFormSubmit(e) {
            e.preventDefault();
            if (!validateForm()) {
                showNotification('Harap perbaiki data yang salah pada formulir.', 'error');
                return;
            }
            
            const editId = document.getElementById('inputForm').getAttribute('data-edit-id');
            const isEditing = !!editId;

            const formData = {
                id: isEditing ? parseInt(editId) : Date.now(),
                nama: document.getElementById('nama').value.trim(),
                nik: document.getElementById('nik').value.trim(),
                whatsapp: document.getElementById('whatsapp').value.replace(/\D/g, ''),
                namaKelompok: document.getElementById('namaKelompok').value.trim() || 'Individu',
                jabatan: document.getElementById('jabatan').value,
                tahunAnggaran: document.getElementById('tahunAnggaran').value,
                kecamatan: document.getElementById('kecamatan').value,
                desa: document.getElementById('desa').value,
                alamat: document.getElementById('alamat').value.trim(),
                jenisBantuan: document.getElementById('jenisBantuan').value,
                namaBantuan: document.getElementById('namaBantuan').value.trim(),
                jumlahBantuan: document.getElementById('jumlahBantuan').value,
                satuanBantuan: document.getElementById('satuanBantuan').value,
                tanggalTerima: document.getElementById('tanggalTerima').value,
                namaPetugas: document.getElementById('namaPetugas').value.trim(),
                driveLink: document.getElementById('driveLink').value.trim(),
                kodeValidasi: document.getElementById('kodeValidasi').value,
                keterangan: document.getElementById('keterangan').value.trim(),
                tanggalInput: isEditing 
                    ? appData.find(item => item.id === parseInt(editId)).tanggalInput 
                    : new Date().toISOString()
            };
            
            if (isEditing) {
                const index = appData.findIndex(item => item.id === parseInt(editId));
                if (index > -1) {
                    appData[index] = formData;
                    showNotification('Data berhasil diperbarui!', 'success');
                }
            } else {
                appData.push(formData);
                showNotification('Data berhasil disimpan!', 'success');
            }
            
            saveData();
            resetForm();
            updateDashboard();
            renderDataTable();

            // Pindah ke tab data setelah berhasil menyimpan
            new bootstrap.Tab(document.getElementById('v-pills-data-tab')).show();
        }

        function resetForm() {
            document.getElementById('inputForm').reset();
            document.getElementById('inputForm').removeAttribute('data-edit-id');
            document.getElementById('jabatan').value = 'Individu';
            document.getElementById('namaKelompok').value = '';
            document.getElementById('tahunAnggaran').value = appSettings.defaultTahun;
            document.getElementById('tanggalTerima').value = new Date().toISOString().split('T')[0];
            document.getElementById('kodeValidasi').value = '';
            document.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));
            document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
        }

        function setError(id, message) {
            document.getElementById(id).classList.add('input-error');
            const errorEl = document.getElementById(`${id}Error`);
            if (errorEl) {
                errorEl.textContent = message;
                errorEl.style.display = 'block';
            }
        }

        function clearError(id) {
            document.getElementById(id).classList.remove('input-error');
            const errorEl = document.getElementById(`${id}Error`);
            if (errorEl) errorEl.style.display = 'none';
        }

        function validateForm() {
            let isValid = true;
            const requiredFields = ['nama', 'nik', 'whatsapp', 'namaPetugas', 'namaBantuan', 'jumlahBantuan', 'kodeValidasi', 'kecamatan', 'desa', 'tanggalTerima'];
            requiredFields.forEach(id => {
                if (!document.getElementById(id).value.trim()) {
                    setError(id, 'Kolom ini wajib diisi.');
                    isValid = false;
                }
            });

            // NIK validation
            const nik = document.getElementById('nik').value.trim();
            if (nik && !/^\d{16}$/.test(nik)) {
                setError('nik', 'NIK harus terdiri dari 16 digit angka.');
                isValid = false;
            } else if (isNikExists(nik)) {
                setError('nik', 'NIK ini sudah terdaftar di sistem.');
                isValid = false;
            }

            // WhatsApp validation
            const whatsapp = document.getElementById('whatsapp').value.replace(/\D/g, '');
            if (whatsapp && !/^\d{9,13}$/.test(whatsapp)) {
                setError('whatsapp', 'Nomor WhatsApp tidak valid (9-13 digit).');
                isValid = false;
            }

            // Drive Link validation
            const driveLink = document.getElementById('driveLink').value.trim();
            if (driveLink && !/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/i.test(driveLink)) {
                setError('driveLink', 'Format URL Google Drive tidak valid.');
                isValid = false;
            }

            return isValid;
        }

        function isNikExists(nik) {
            const editId = document.getElementById('inputForm').getAttribute('data-edit-id');
            return appData.some(data => data.nik === nik && data.id !== (editId ? parseInt(editId) : null));
        }
        
        function setBukanKelompok() {
            document.getElementById('namaKelompok').value = 'Individu';
            document.getElementById('jabatan').value = 'Individu';
        }

        function handleJabatanChange() {
            const jabatan = document.getElementById('jabatan').value;
            const namaKelompok = document.getElementById('namaKelompok');
            if (jabatan === 'Individu') {
                namaKelompok.value = 'Individu';
            } else if (namaKelompok.value.toLowerCase() === 'individu') {
                namaKelompok.value = ''; // Kosongkan jika bukan individu
            }
        }
        
        function generateKodeValidasi() {
            const nikInput = document.getElementById('nik');
            const nik = nikInput.value.trim();
            clearError('nik');

            if (!/^\d{16}$/.test(nik)) {
                setError('nik', 'Isi NIK dengan 16 digit angka sebelum generate kode.');
                showNotification('NIK tidak valid untuk generate kode.', 'error');
                return;
            }
            if (isNikExists(nik)) {
                setError('nik', 'NIK ini sudah terdaftar, tidak bisa generate kode baru.');
                showNotification('NIK sudah terdaftar.', 'error');
                return;
            }

            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 5; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            document.getElementById('kodeValidasi').value = result;
            clearError('kodeValidasi');
            showNotification('Kode validasi berhasil digenerate.', 'success');
        }
        
        function updateSatuanBantuan() {
            const jenis = document.getElementById('jenisBantuan').value;
            const satuanSelect = document.getElementById('satuanBantuan');
            const options = {
                'Uang': ['Rupiah'],
                'Barang': ['Unit', 'Paket', 'Set', 'Buah', 'Ekor'],
                'Jasa': ['Jam', 'Hari', 'Paket', 'Kegiatan']
            };
            satuanSelect.innerHTML = (options[jenis] || []).map(opt => `<option value="${opt}">${opt}</option>`).join('');
        }
        
        // --- DATA PERSISTENCE (LocalStorage) ---
        function loadData() {
            try {
                const savedData = localStorage.getItem('barjasData');
                appData = savedData ? JSON.parse(savedData) : [];
                const savedCodes = localStorage.getItem('barjasGeneratedCodes');
                generatedCodes = savedCodes ? JSON.parse(savedCodes) : {};
            } catch (e) {
                console.error("Gagal memuat data:", e);
                appData = [];
                generatedCodes = {};
            }
            renderDataTable();
        }
        
        function saveData() {
            localStorage.setItem('barjasData', JSON.stringify(appData));
            localStorage.setItem('barjasGeneratedCodes', JSON.stringify(generatedCodes));
        }

        function loadSettings() {
            const savedSettings = localStorage.getItem('barjasSettings');
            if (savedSettings) {
                Object.assign(appSettings, JSON.parse(savedSettings));
            }
        }

        function saveSettings() {
            localStorage.setItem('barjasSettings', JSON.stringify(appSettings));
        }

        function applySettingsToUI() {
            document.getElementById('itemsPerPage').value = appSettings.itemsPerPage;
            document.getElementById('notifications').checked = appSettings.notifications;
            document.getElementById('appName').value = appSettings.appName;
            document.getElementById('appSubtitle').value = appSettings.appSubtitle;
            document.getElementById('defaultTahun').value = appSettings.defaultTahun;
            document.getElementById('lastBackupDate').textContent = appSettings.lastBackupDate;

            document.querySelector('.app-title').textContent = appSettings.appName;
            document.querySelectorAll('.app-subtitle')[0].textContent = appSettings.appSubtitle;
        }

        function handleSaveSettings(e) {
            e.preventDefault();
            const newSecurityCode = document.getElementById('settingSecurityCode').value;
            if (newSecurityCode) appSettings.securityCode = newSecurityCode;
            
            appSettings.itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
            appSettings.notifications = document.getElementById('notifications').checked;
            appSettings.appName = document.getElementById('appName').value;
            appSettings.appSubtitle = document.getElementById('appSubtitle').value;
            appSettings.defaultTahun = document.getElementById('defaultTahun').value;

            saveSettings();
            applySettingsToUI();
            showNotification('Pengaturan berhasil disimpan.', 'success');
            renderDataTable();
        }
        
        // --- DATA TABLE, PAGINATION, SEARCH, FILTER ---
        function renderDataTable() {
            const tableBody = document.getElementById('dataTableBody');
            tableBody.innerHTML = '';
            
            const dataToRender = isFilterActive ? filteredData : appData;
            const itemsPerPage = parseInt(appSettings.itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, dataToRender.length);
            
            if (dataToRender.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="17" class="text-center py-5 text-muted"><i class="fas fa-inbox fa-2x mb-2 d-block"></i>Tidak ada data</td></tr>`;
                document.getElementById('tableInfo').textContent = 'Menampilkan 0 dari 0 data';
                document.getElementById('pagination').innerHTML = '';
                return;
            }
            
            for (let i = startIndex; i < endIndex; i++) {
                const data = dataToRender[i];
                const row = document.createElement('tr');
                const whatsappDisplay = data.whatsapp ? `0${data.whatsapp}` : '-';
                
                row.innerHTML = `
                    <td>${i + 1}</td>
                    <td>${data.nama}</td>
                    <td>${data.nik}</td>
                    <td><a href="https://wa.me/62${data.whatsapp}" target="_blank" class="text-success text-decoration-none fw-bold"><i class="fab fa-whatsapp"></i> ${whatsappDisplay}</a></td>
                    <td>${data.namaKelompok || '-'}</td>
                    <td>${data.jabatan || '-'}</td>
                    <td><span class="badge bg-secondary">${data.tahunAnggaran}</span></td>
                    <td>${data.kecamatan}</td>
                    <td>${data.desa}</td>
                    <td>${data.jenisBantuan}</td>
                    <td>${data.namaBantuan || '-'}</td>
                    <td class="fw-bold text-dark">${formatNumber(data.jumlahBantuan)} <small>${data.satuanBantuan}</small></td>
                    <td>${formatDate(data.tanggalTerima)}</td>
                    <td>${data.namaPetugas || '-'}</td>
                    <td>${data.driveLink ? `<a href="${data.driveLink}" class="btn btn-sm btn-outline-primary" target="_blank"><i class="fas fa-link"></i></a>` : '-'}</td>
                    <td><code class="text-danger">${data.kodeValidasi}</code></td>
                    <td>
                        <div class="btn-group btn-group-sm shadow-sm">
                            <button class="btn btn-primary" onclick="editData(${data.id})" title="Edit"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger" onclick="deleteData(${data.id})" title="Hapus"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            }
            
            document.getElementById('tableInfo').textContent = `Menampilkan ${startIndex + 1} - ${endIndex} dari ${dataToRender.length} data`;
            updatePagination(dataToRender.length);
        }
        
        function updatePagination(totalItems) {
            const itemsPerPage = parseInt(appSettings.itemsPerPage);
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const paginationEl = document.getElementById('pagination');
            paginationEl.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            const createPageItem = (page, text, disabled = false, active = false) => {
                const li = document.createElement('li');
                li.className = `page-item ${disabled ? 'disabled' : ''} ${active ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" onclick="changePage(${page}); return false;">${text}</a>`;
                return li;
            };

            paginationEl.appendChild(createPageItem(currentPage - 1, '<i class="fas fa-chevron-left"></i>', currentPage === 1));

            // Logic to show limited page numbers
            const maxPagesToShow = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
            let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);
            if (endPage - startPage + 1 < maxPagesToShow) {
                startPage = Math.max(1, endPage - maxPagesToShow + 1);
            }

            for (let i = startPage; i <= endPage; i++) {
                paginationEl.appendChild(createPageItem(i, i, false, i === currentPage));
            }

            paginationEl.appendChild(createPageItem(currentPage + 1, '<i class="fas fa-chevron-right"></i>', currentPage === totalPages));
        }
        
        function changePage(page) {
            const dataToRender = isFilterActive ? filteredData : appData;
            const totalPages = Math.ceil(dataToRender.length / parseInt(appSettings.itemsPerPage));
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderDataTable();
            }
        }
        
        function handleSearch() {
            const searchTerm = document.getElementById('searchData').value.toLowerCase();
            isFilterActive = !!searchTerm;
            filteredData = isFilterActive ? appData.filter(d => Object.values(d).some(v => String(v).toLowerCase().includes(searchTerm))) : [];
            currentPage = 1;
            renderDataTable();
        }
        
        function clearSearch() {
            document.getElementById('searchData').value = '';
            handleSearch();
        }
        
        function applyFilter() {
            const filters = {
                tahun: document.getElementById('filterTahun').value,
                kecamatan: document.getElementById('filterKecamatan').value,
                desa: document.getElementById('filterDesa').value,
                jenis: document.getElementById('filterJenis').value,
            };
            
            filteredData = appData.filter(d => 
                (!filters.tahun || d.tahunAnggaran == filters.tahun) &&
                (!filters.kecamatan || d.kecamatan === filters.kecamatan) &&
                (!filters.desa || d.desa === filters.desa) &&
                (!filters.jenis || d.jenisBantuan === filters.jenis)
            );
            
            renderFilterTable();
            document.getElementById('filterResultCount').textContent = `${filteredData.length} Data Ditemukan`;
            showNotification(`Filter diterapkan. Ditemukan ${filteredData.length} data.`, 'success');
        }
        
        function resetFilter() {
            ['filterTahun', 'filterKecamatan', 'filterDesa', 'filterJenis'].forEach(id => document.getElementById(id).value = '');
            filteredData = [];
            renderFilterTable();
            document.getElementById('filterResultCount').textContent = '0 Data';
            showNotification('Filter direset.', 'info');
        }
        
        function renderFilterTable() {
            const tableBody = document.getElementById('filterTableBody');
            tableBody.innerHTML = '';
            
            if (filteredData.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="16" class="text-center py-4">Tidak ada data yang sesuai</td></tr>`;
                return;
            }
            
            filteredData.forEach((data, i) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${i + 1}</td> <td>${data.nama}</td> <td>${data.nik}</td> <td>0${data.whatsapp}</td>
                    <td>${data.namaKelompok || '-'}</td> <td>${data.jabatan || '-'}</td> <td>${data.tahunAnggaran}</td>
                    <td>${data.kecamatan}</td> <td>${data.desa}</td> <td>${data.jenisBantuan}</td>
                    <td>${data.namaBantuan || '-'}</td> <td>${formatNumber(data.jumlahBantuan)} ${data.satuanBantuan}</td>
                    <td>${formatDate(data.tanggalTerima)}</td> <td>${data.namaPetugas || '-'}</td>
                    <td>${data.driveLink ? 'Ya' : 'Tidak'}</td> <td>${data.kodeValidasi}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // --- CRUD ACTIONS ---
        function editData(id) {
            const data = appData.find(item => item.id === id);
            if (!data) return;
            
            Object.keys(data).forEach(key => {
                const el = document.getElementById(key);
                if (el) el.value = data[key];
            });

            // Trigger input event for correct formatting
            const whatsappInput = document.getElementById('whatsapp');
            whatsappInput.value = data.whatsapp; // Set the raw number
            
            document.getElementById('inputForm').setAttribute('data-edit-id', id);
            new bootstrap.Tab(document.getElementById('v-pills-input-tab')).show();
            window.scrollTo(0, 0);
            showNotification('Mode edit aktif. Klik "Simpan Data" setelah selesai.', 'info');
        }
        
        function deleteData(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data ini secara permanen?')) {
                appData = appData.filter(item => item.id !== id);
                saveData();
                showNotification('Data berhasil dihapus.', 'success');
                updateDashboard();
                renderDataTable();
            }
        }
        
        // --- DASHBOARD & CHARTS ---
        function updateDashboard() {
            document.getElementById('totalPenerima').textContent = formatNumber(appData.length);
            
            const uangData = appData.filter(d => d.jenisBantuan === 'Uang');
            const totalBantuan = uangData.reduce((sum, d) => sum + (parseFloat(d.jumlahBantuan) || 0), 0);
            document.getElementById('totalBantuan').textContent = `Rp ${formatNumber(totalBantuan)}`;
            
            const tahunCount = appData.reduce((acc, d) => ({...acc, [d.tahunAnggaran]: (acc[d.tahunAnggaran] || 0) + 1}), {});
            const tahunAktif = Object.keys(tahunCount).reduce((a, b) => tahunCount[a] > tahunCount[b] ? a : b, appSettings.defaultTahun);
            document.getElementById('tahunAktif').textContent = tahunAktif;
            
            const rataBantuan = uangData.length > 0 ? totalBantuan / uangData.length : 0;
            document.getElementById('rataBantuan').textContent = `Rp ${formatNumber(rataBantuan.toFixed(0))}`;
            
            updateCharts();
            updateRecentData();
            document.getElementById('settingsDataCount').textContent = `${appData.length} Record`;
        }
        
        function updateRecentData() {
            const recentDataContainer = document.getElementById('recentData');
            recentDataContainer.innerHTML = '';
            
            const recent = [...appData].sort((a, b) => new Date(b.tanggalInput) - new Date(a.tanggalInput)).slice(0, 5);
            
            if (recent.length === 0) {
                recentDataContainer.innerHTML = `<tr><td colspan="5" class="text-center py-3 text-muted">Belum ada aktivitas terbaru</td></tr>`;
                return;
            }
            
            recent.forEach(d => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><small class="text-muted">${formatDate(d.tanggalInput)}</small></td>
                    <td class="fw-bold">${d.nama}</td> <td>${d.desa}</td>
                    <td><span class="badge bg-info text-dark">${d.namaBantuan}</span></td> 
                    <td class="text-success fw-bold">${formatNumber(d.jumlahBantuan)} <small>${d.satuanBantuan}</small></td>
                `;
                recentDataContainer.appendChild(row);
            });
        }
        
        function initializeCharts() {
            Chart.defaults.font.family = "'Poppins', 'Segoe UI', sans-serif";
            const pieCtx = document.getElementById('kecamatanChart')?.getContext('2d');
            if (pieCtx) {
                window.kecamatanChart = new Chart(pieCtx, { 
                    type: 'doughnut', 
                    options: { 
                        responsive: true, 
                        plugins: { legend: { position: 'right', labels: { usePointStyle: true } } },
                        cutout: '60%'
                    } 
                });
            }
            
            const barCtx = document.getElementById('tahunChart')?.getContext('2d');
            if (barCtx) {
                window.tahunChart = new Chart(barCtx, { 
                    type: 'bar', 
                    options: { 
                        responsive: true, 
                        scales: { y: { beginAtZero: true, grid: { borderDash: [2, 4] } }, x: { grid: { display: false } } },
                        plugins: { legend: { display: false } }
                    } 
                });
            }
        }
        
        function updateCharts() {
            if (!appData || appData.length === 0) return;

            const kecamatanData = appData.reduce((acc, d) => ({...acc, [d.kecamatan]: (acc[d.kecamatan] || 0) + 1}), {});
            if (window.kecamatanChart) {
                window.kecamatanChart.data = {
                    labels: Object.keys(kecamatanData),
                    datasets: [{ 
                        data: Object.values(kecamatanData), 
                        backgroundColor: ['#006064', '#00838f', '#0097a7', '#00acc1', '#26c6da', '#4dd0e1', '#80deea', '#b2ebf2', '#e0f7fa', '#ff6f00', '#ffa000', '#ffb300', '#ffca28', '#ffecb3'],
                        borderWidth: 0
                    }]
                };
                window.kecamatanChart.update();
            }
            
            const tahunData = appData.reduce((acc, d) => ({...acc, [d.tahunAnggaran]: (acc[d.tahunAnggaran] || 0) + 1}), {});
            const sortedYears = Object.keys(tahunData).sort();
            if (window.tahunChart) {
                window.tahunChart.data = {
                    labels: sortedYears,
                    datasets: [{ 
                        label: 'Jumlah Penerima', 
                        data: sortedYears.map(year => tahunData[year]), 
                        backgroundColor: '#006064',
                        borderRadius: 5
                    }]
                };
                window.tahunChart.update();
            }
        }
        
        // --- PRINT, PREVIEW & EXPORT ---
        function getFilteredDataForExport(prefix) {
            const filters = {
                tahun: document.getElementById(`${prefix}Tahun`).value,
                kecamatan: document.getElementById(`${prefix}Kecamatan`).value,
                jenis: document.getElementById(`${prefix}Jenis`).value,
            };
            
            if (!filters.tahun && !filters.kecamatan && !filters.jenis) return appData;

            return appData.filter(d => 
                (!filters.tahun || d.tahunAnggaran == filters.tahun) &&
                (!filters.kecamatan || d.kecamatan === filters.kecamatan) &&
                (!filters.jenis || d.jenisBantuan === filters.jenis)
            );
        }

        function printToPdf() {
            const dataToPrint = getFilteredDataForExport('print');
            if (dataToPrint.length === 0) return showNotification('Tidak ada data untuk dicetak sesuai filter.', 'warning');
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape', 'pt', 'a4');
            
            // Header Report Modern
            doc.setFillColor(0, 96, 100); // Dark Cyan
            doc.rect(0, 0, 842, 60, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.text('LAPORAN BANTUAN PINJAM PAKAI NELAYAN', 40, 38);
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text('Dinas Peternakan dan Perikanan Kab. Situbondo', 40, 52);
            doc.text(`Dicetak: ${new Date().toLocaleDateString('id-ID')}`, 780, 38, { align: 'right' });
            
            const cols = ["No", "Nama", "NIK", "Desa", "Kecamatan", "Nama Bantuan", "Jumlah", "Tanggal"];
            const rows = dataToPrint.map((d, i) => [
                i + 1, d.nama, d.nik, d.desa, d.kecamatan, d.namaBantuan || '-',
                `${formatNumber(d.jumlahBantuan)} ${d.satuanBantuan}`, formatDate(d.tanggalTerima)
            ]);
            
            doc.autoTable({ 
                head: [cols], 
                body: rows, 
                startY: 80, 
                theme: 'striped', 
                headStyles: { fillColor: [0, 96, 100], textColor: 255 },
                alternateRowStyles: { fillColor: [224, 247, 250] }
            });
            doc.save(`Laporan_Bantuan_Nelayan_${new Date().toISOString().slice(0,10)}.pdf`);
            showNotification('Laporan PDF berhasil diunduh.', 'success');
        }
        
        function showPreview() {
            const dataToPreview = getFilteredDataForExport('print');
            if (dataToPreview.length === 0) return showNotification('Tidak ada data untuk pratinjau sesuai filter.', 'warning');

            document.getElementById('previewModalTitle').textContent = `Pratinjau Laporan (${dataToPreview.length} data)`;
            let content = `
                <div class="print-header text-center mb-4 border-bottom pb-3">
                    <h4 style="color: var(--primary-main); font-weight: bold;">LAPORAN DATA BANTUAN NELAYAN</h4>
                    <p class="mb-1">Dinas Peternakan dan Perikanan Kabupaten Situbondo</p>
                    <p class="text-muted small">Periode Cetak: ${formatDate(new Date().toISOString())}</p>
                </div>
                <table class="table table-bordered table-striped">
                    <thead class="bg-primary text-white"><tr>
                    <th>No</th><th>Nama</th><th>NIK</th><th>Desa</th><th>Nama Bantuan</th><th>Jumlah</th><th>Tanggal</th>
                </tr></thead><tbody>`;

            dataToPreview.forEach((d, i) => {
                content += `<tr>
                    <td>${i + 1}</td><td>${d.nama}</td><td>${d.nik}</td><td>${d.desa}</td>
                    <td>${d.namaBantuan}</td><td>${formatNumber(d.jumlahBantuan)} ${d.satuanBantuan}</td><td>${formatDate(d.tanggalTerima)}</td>
                </tr>`;
            });

            content += `</tbody></table>`;
            document.getElementById('previewContent').innerHTML = content;
            new bootstrap.Modal(document.getElementById('previewModal')).show();
        }

        function exportData(format) {
            const dataToExport = getFilteredDataForExport('export');
            if (dataToExport.length === 0) return showNotification('Tidak ada data untuk diekspor sesuai filter.', 'warning');

            const timestamp = new Date().toISOString().slice(0, 10);
            const filename = `data_bantuan_nelayan_${timestamp}`;

            switch(format) {
                case 'excel':
                    const ws = XLSX.utils.json_to_sheet(dataToExport);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'Data');
                    XLSX.writeFile(wb, `${filename}.xlsx`);
                    break;
                case 'csv':
                    const csvWs = XLSX.utils.json_to_sheet(dataToExport);
                    const csv = XLSX.utils.sheet_to_csv(csvWs);
                    downloadFile(csv, 'text/csv', `${filename}.csv`);
                    break;
                case 'json':
                    downloadFile(JSON.stringify(dataToExport, null, 2), 'application/json', `${filename}.json`);
                    break;
                case 'pdf':
                    printToPdf(); // Re-use the nice PDF function
                    break;
            }
            showNotification(`Data berhasil diekspor ke format ${format.toUpperCase()}.`, 'success');
        }

        function downloadFile(content, mimeType, filename) {
            const blob = new Blob([content], { type: mimeType });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- BACKUP, RESTORE, RESET & RELOAD FROM REPO ---

        function autoBackupData() {
            if (appData.length === 0) {
                return;
            }

            const timestamp = new Date().toISOString().slice(0, 10);
            const filename = `SISTEM-NELAYAN-auto-backup-${timestamp}`;
            const dataToBackup = { appData, appSettings, generatedCodes };
            
            const dataStr = btoa(unescape(encodeURIComponent(JSON.stringify(dataToBackup))));
            // Note: Auto backup usually shouldn't download automatically to avoid spam, 
            // but we prepare the data. In this specific app flow, we just update the internal record.
            
            appSettings.lastBackupDate = new Date().toLocaleDateString('id-ID');
            saveSettings();
        }

        function backupData() {
            if (appData.length === 0) return showNotification('Tidak ada data untuk dibackup.', 'warning');
            
            const filename = document.getElementById('backupFileName').value || 'backup-nelayan-secure';
            const dataToBackup = { appData, appSettings, generatedCodes };
            const dataStr = btoa(unescape(encodeURIComponent(JSON.stringify(dataToBackup))));
            
            downloadFile(dataStr, 'application/json', `${filename}-${new Date().toISOString().slice(0,10)}.json`);
            
            appSettings.lastBackupDate = new Date().toLocaleDateString('id-ID');
            saveSettings();
            applySettingsToUI();
            showNotification('Backup data terenkripsi berhasil diunduh.', 'success');
        }
        
        function handleReloadFromRepo() {
            if(!confirm("Apakah Anda yakin ingin me-reload data dari repository? Data lokal saat ini akan ditimpa.")) return;

            const btn = document.getElementById('btn-reload-repo');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin feature-icon"></i> Loading...';
            btn.disabled = true;

            const oldScript = document.getElementById('reload-script');
            if(oldScript) oldScript.remove();

            const script = document.createElement('script');
            script.id = 'reload-script';
            script.src = './reload.js?v=' + new Date().getTime(); 

            script.onload = function() {
                try {
                    if (window.BARJAS_BACKUP_ENCRYPTED) {
                        const rawContent = window.BARJAS_BACKUP_ENCRYPTED;
                        let restored;

                        try {
                            if (typeof rawContent === 'string') {
                                restored = JSON.parse(decodeURIComponent(escape(atob(rawContent))));
                            } else {
                                restored = rawContent;
                            }
                        } catch (decryptionError) {
                            throw new Error("Gagal mendekripsi data. Format tidak valid.");
                        }
                        
                        if(restored && restored.appData && Array.isArray(restored.appData)) {
                            appData = restored.appData;
                            if(restored.appSettings) Object.assign(appSettings, restored.appSettings);
                            if(restored.generatedCodes) generatedCodes = restored.generatedCodes;

                            saveData();
                            saveSettings();
                            applySettingsToUI();
                            updateDashboard();
                            renderDataTable();
                            
                            showNotification('Data berhasil di-reload & didekripsi dari Repository!', 'success');
                        } else {
                            throw new Error('Format data hasil dekripsi tidak valid.');
                        }
                    } else {
                        throw new Error('Variabel backup tidak ditemukan di reload.js.');
                    }
                } catch (e) {
                    showNotification('Error: ' + e.message, 'error');
                    console.error(e);
                } finally {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    delete window.BARJAS_BACKUP_ENCRYPTED;
                }
            };

            script.onerror = function() {
                showNotification('Gagal memuat file reload.js.', 'error');
                btn.innerHTML = originalText;
                btn.disabled = false;
            };

            document.body.appendChild(script);
        }

        function enableRestoreButton() {
            document.getElementById('restoreDataBtn').disabled = !this.files.length;
        }
        
        function restoreData() {
            const file = document.getElementById('restoreFileInput').files[0];
            if (!file || !confirm('PENTING: Restore akan menimpa semua data dan pengaturan yang ada saat ini. Lanjutkan?')) return;
            
            const reader = new FileReader();
            reader.onload = e => {
                try {
                    let restored;
                    const content = e.target.result;
                    try {
                        restored = JSON.parse(decodeURIComponent(escape(atob(content))));
                    } catch (err) {
                        restored = JSON.parse(content);
                    }

                    if (restored.appData && restored.appSettings) {
                        appData = restored.appData;
                        Object.assign(appSettings, restored.appSettings);
                        generatedCodes = restored.generatedCodes || {};

                        saveData();
                        saveSettings();
                        applySettingsToUI();
                        document.getElementById('restoreFileInput').value = '';
                        document.getElementById('restoreDataBtn').disabled = true;
                        updateDashboard();
                        renderDataTable();
                        showNotification('Data dan pengaturan berhasil direstore.', 'success');
                    } else {
                        throw new Error("Format file backup tidak valid.");
                    }
                } catch (error) {
                    showNotification('Gagal merestore data. File mungkin rusak atau tidak valid.', 'error');
                    console.error('Restore error:', error);
                }
            };
            reader.readAsText(file);
        }
        
        function enableResetButton() {
            document.getElementById('confirmResetBtn').disabled = this.value !== 'RESET';
        }
        
        function resetData() {
            appData = [];
            generatedCodes = {};
            saveData();
            
            const resetModal = bootstrap.Modal.getInstance(document.getElementById('confirmResetModal'));
            if(resetModal) resetModal.hide();
            
            document.getElementById('resetConfirmationInput').value = '';
            updateDashboard();
            renderDataTable();
            showNotification('PERHATIAN: Semua data telah direset!', 'warning');
        }

        // --- UTILITY & HELPER FUNCTIONS ---
        function setupBrowserInfo() {
            const agent = navigator.userAgent;
            let browserName = "Unknown";
            if (agent.indexOf("Firefox") > -1) browserName = "Firefox";
            else if (agent.indexOf("Chrome") > -1) browserName = "Chrome";
            else if (agent.indexOf("Safari") > -1) browserName = "Safari";
            document.getElementById('browserInfo').textContent = browserName;
            
            try {
                const usedStorage = (JSON.stringify(localStorage).length / 1024).toFixed(2);
                document.getElementById('storageInfo').textContent = `${usedStorage} KB`;
            } catch (e) {
                document.getElementById('storageInfo').textContent = 'Unavailable';
            }
        }
        
        function toggleMobileMenu() {
            document.getElementById('sidebarMenu').classList.toggle('mobile-show');
            document.getElementById('sidebarOverlay').classList.toggle('mobile-show');
        }
        
        function showNotification(message, type = 'info') {
            if (!appSettings.notifications) return;

            const toastEl = document.querySelector('.notification-toast');
            const toastHeader = toastEl.querySelector('.toast-header');
            const toastTitle = document.getElementById('toastTitle');
            document.getElementById('toastMessage').textContent = message;
            
            const styles = {
                success: { bg: 'bg-success', text: 'text-white', title: 'Berhasil' },
                error: { bg: 'bg-danger', text: 'text-white', title: 'Gagal' },
                warning: { bg: 'bg-warning', text: 'text-dark', title: 'Peringatan' },
                info: { bg: 'bg-primary', text: 'text-white', title: 'Informasi' }
            };
            
            toastHeader.className = `toast-header ${styles[type].bg} ${styles[type].text}`;
            toastTitle.textContent = styles[type].title;
            
            new bootstrap.Toast(toastEl).show();
        }
        
        function formatDate(dateString) {
            if (!dateString) return '-';
            return new Date(dateString).toLocaleDateString('id-ID', { day: '2-digit', month: 'short', year: 'numeric' });
        }
        
        function formatNumber(num) {
            if (isNaN(num)) return num; // Return original if not a number
            return new Intl.NumberFormat('id-ID').format(num);
        }
    </script>
</body>
</html>
