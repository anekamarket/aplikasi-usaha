<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <!-- PERBAIKAN VIEWPORT: Tambahkan properti untuk zoom dan responsif -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>UMKM CASH - Aplikasi Kasir Digital Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    
   
</head>
<body>
    <!-- Loading Overlay Global -->
    <div id="globalLoading" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingMessage">Memproses...</div>
    </div>
    
    <!-- Modal Loading Khusus -->
    <div id="modalLoading" class="modal-loading">
        <div class="modal-loading-content">
            <div class="modal-loading-spinner"></div>
            <div class="modal-loading-text" id="modalLoadingMessage">Memproses...</div>
        </div>
    </div>

    <!-- Welcome Toast Modal -->
    <!-- PERBAIKAN: Tambahkan tombol close dan perbaikan struktur -->
    <div id="welcomeToast" class="welcome-toast">
        <button class="welcome-toast-close">&times;</button>
        <div class="welcome-icon">
            <i class="fas fa-hand-sparkles"></i>
        </div>
        <h2 class="welcome-title">Selamat Datang di UMKM CASH!</h2>
        <div class="welcome-message">
            Mari wujudkan usaha mandiri yang tangguh dan berdaya saing.<br>
            Aplikasi kasir digital terbaik untuk mengelola bisnis Anda dengan mudah dan profesional.
        </div>
        <div class="welcome-submessage">
            <i class="fas fa-clock"></i> Notifikasi ini akan hilang dalam <span id="countdown">15</span> detik
        </div>
    </div>

    <div id="toast" class="toast">
        <i class="fas fa-info-circle"></i>
        <span id="toast-message">Notification message</span>
    </div>

    <!-- Modal untuk Input Uang Kas Awal -->
    <div id="cashStartModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Input Uang Kas Awal Shift</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="cash-management-container">
                    <p>Silakan input jumlah uang kas yang tersedia untuk memulai shift penjualan hari ini.</p>
                    <div class="form-group">
                        <label class="form-label">Jumlah Uang Kas Awal (Rp)</label>
                        <input type="number" id="initialCashAmount" class="form-control" placeholder="Masukkan jumlah uang kas" min="0" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Catatan (Opsional)</label>
                        <textarea id="cashNote" class="form-control" placeholder="Contoh: Uang kas dari shift sebelumnya" rows="3"></textarea>
                    </div>
                    <div class="cash-summary-card">
                        <h3>Shift yang akan dimulai</h3>
                        <p id="shiftDateDisplay"></p>
                        <p>Kasir: <strong id="shiftCashierName"></strong></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn" id="cancelShiftBtn">Batal</button>
                <!-- PERBAIKAN: Tambahkan tombol Skip khusus admin -->
                <button class="btn btn-info" id="skipShiftBtn" style="display: none;">Lewati (Admin)</button>
                <button class="btn btn-success" id="startShiftBtn">Mulai Shift</button>
            </div>
        </div>
    </div>

    <!-- Modal untuk Tutup Shift -->
    <div id="closeShiftModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">Tutup Shift Penjualan</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="cash-management-container">
                    <div class="shift-status-badge shift-open">SHIFT AKTIF</div>
                    
                    <div class="cash-summary-card">
                        <h3>Uang Kas Awal</h3>
                        <p id="initialCashDisplay">Rp 0</p>
                    </div>
                    
                    <div class="profit-calculation-container">
                        <h4 class="panel-title">Rincian Penjualan Shift</h4>
                        
                        <div class="form-group">
                            <label class="form-label">Total Penjualan Kotor</label>
                            <input type="number" id="totalSalesAmount" class="form-control" readonly>
                        </div>
                        
                        <div class="profit-input-group">
                            <div class="form-group">
                                <label class="form-label">Pengeluaran Hari Ini (Rp)</label>
                                <input type="number" id="dailyExpenses" class="form-control" placeholder="Total pengeluaran" min="0" value="0">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Pendapatan Lainnya (Rp)</label>
                                <input type="number" id="otherIncome" class="form-control" placeholder="Pendapatan tambahan" min="0" value="0">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Uang Kas Fisik yang Terhitung (Rp)</label>
                            <input type="number" id="actualCashCount" class="form-control" placeholder="Jumlah uang kas fisik" min="0" required>
                        </div>
                        
                        <div class="profit-result-card">
                            <h4>Selisih Kas</h4>
                            <p id="cashDifference">Rp 0</p>
                        </div>
                        
                        <div class="profit-breakdown">
                            <div class="breakdown-item">
                                <label>Uang Kas Seharusnya</label>
                                <span id="expectedCash">Rp 0</span>
                            </div>
                            <div class="breakdown-item">
                                <label>Uang Kas Aktual</label>
                                <span id="actualCash">Rp 0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Catatan Penutupan Shift</label>
                        <textarea id="shiftCloseNote" class="form-control" placeholder="Catatan penting untuk shift ini" rows="3"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn">Batal</button>
                <button class="btn btn-success" id="confirmCloseShiftBtn">Tutup Shift</button>
            </div>
        </div>
    </div>

    <!-- Modal untuk Perhitungan Laba -->
    <div id="profitCalculationModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">Perhitungan Laba</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <div class="tab active" data-tab="profitReport"><i class="fas fa-chart-line"></i> Laporan Laba</div>
                    <div class="tab" data-tab="profitSettings"><i class="fas fa-cog"></i> Pengaturan</div>
                </div>
                
                <div class="tab-content active" id="profitReportTab">
                    <div class="form-group mt-3">
                        <label class="form-label">Periode Perhitungan</label>
                        <select id="profitPeriod" class="form-control">
                            <option value="today">Hari Ini</option>
                            <option value="week">Minggu Ini</option>
                            <option value="month">Bulan Ini</option>
                            <option value="custom">Rentang Tanggal</option>
                        </select>
                    </div>
                    
                    <div id="profitCustomDateRange" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">Dari Tanggal</label>
                            <input type="date" id="profitStartDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Sampai Tanggal</label>
                            <input type="date" id="profitEndDate" class="form-control">
                        </div>
                    </div>
                    
                    <button class="btn btn-success mt-2" id="calculateProfitBtn">Hitung Laba</button>
                    
                    <div id="profitResults" class="mt-3"></div>
                </div>
                
                <div class="tab-content" id="profitSettingsTab">
                    <div class="cash-management-container">
                        <h4 class="panel-title">Pengaturan Perhitungan Laba</h4>
                        
                        <div class="form-group">
                            <label class="form-label">Persentase HPP (Harga Pokok Penjualan) Default (%)</label>
                            <input type="number" id="defaultCOGS" class="form-control" min="0" max="100" value="60">
                            <small class="form-text text-muted">Persentase default untuk menghitung HPP dari total penjualan</small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Biaya Operasional Tetap Bulanan (Rp)</label>
                            <input type="number" id="monthlyFixedCost" class="form-control" min="0" value="0">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Kode Keamanan Akses Laba</label>
                            <input type="password" id="profitSecurityCode" class="form-control" placeholder="Masukkan kode keamanan">
                            <small class="form-text text-muted">Kode ini diperlukan untuk mengakses fitur perhitungan laba</small>
                        </div>
                        
                        <button class="btn btn-success" id="saveProfitSettingsBtn">Simpan Pengaturan</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn">Tutup</button>
                <button class="btn btn-info" id="downloadProfitReportBtn" style="display: none;"><i class="fas fa-file-pdf"></i> Unduh PDF</button>
            </div>
        </div>
    </div>

    <!-- Modal Info Aplikasi -->
    <div id="appInfoModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">Tentang Aplikasi</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="app-info-container">
                    <div class="app-info-logo">
                        <i class="fas fa-cash-register fa-3x"></i>
                    </div>
                    <h2>UMKM CASH - Aplikasi Kasir Digital Premium</h2>
                    <p>Versi: <strong>PREMIUM</strong></p>
                    <p>Dikembangkan oleh: <strong>Lentera Karya Situbondo</strong></p>
                    
                    <div class="app-info-contact">
                        <h4>Kontak Developer:</h4>
                        <p>
                            <i class="fas fa-envelope"></i> Email: 
                            <a href="mailto:info@aplikasiusaha.com" target="_blank">info@aplikasiusaha.com</a>
                        </p>
                        <p>
                            <i class="fab fa-whatsapp"></i> WhatsApp: 
                            <a href="https://wa.me/6285647709114" target="_blank">085647709114</a>
                        </p>
                        <p>
                            <i class="fas fa-globe"></i> Website: 
                            <a href="https://www.aplikasiusaha.com/umkmcash" target="_blank">www.aplikasiusaha.com/umkmcash</a>
                        </p>
                    </div>
                    
                    <div class="app-info-features">
                        <h4>Fitur Utama Aplikasi:</h4>
                        <ul>
                            <li>Manajemen Menu dan Kategori</li>
                            <li>Transaksi Penjualan (Dine-in & Takeaway)</li>
                            <li>Manajemen Member dengan KTA Digital</li>
                            <li>Laporan Penjualan Lengkap</li>
                            <li>Histori Transaksi</li>
                            <li>Info Pesanan Dapur Real-time</li>
                            <li>Backup & Restore Data Terenkripsi</li>
                            <li>Perhitungan Laba Otomatis</li>
                            <li>Manajemen Shift Kasir</li>
                            <li>Multi-User dengan Sistem Hak Akses</li>
                            <li>Generate PDF untuk Menu dan Laporan</li>
                            <li>Struk Digital dengan QR Code</li>
                            <li>Notifikasi Pesanan Dapur</li>
                            <li>Pengaturan Keamanan Berlapis</li>
                            <!-- PERBAIKAN: Tambahkan fitur cetak ulang struk -->
                            <li>Cetak Ulang Struk dari Histori Transaksi</li>
                        </ul>
                    </div>
                    
                    <div class="app-info-footer">
                        <p><strong>&copy; <span id="currentYear3"></span> UMKM CASH - Hak Cipta Dilindungi Undang-Undang</strong></p>
                        <p class="fishery-support">
                            <i class="fas fa-hands-helping"></i> Supported by Dinas Perikanan Situbondo - Bidang Pemberdayaan Nelayan
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn">Tutup</button>
            </div>
        </div>
    </div>

    <div id="loginModal" class="modal" style="display: flex;">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">
                    <i class="fas fa-cash-register"></i>
                </div>
                <h1 class="login-title">UMKM CASH</h1>
                <p>Aplikasi Kasir Digital <span class="premium-badge">PREMIUM</span></p>
                <div class="fishery-badge mt-2">
                    <i class="fas fa-hands-helping"></i> Supported by Dinas Perikanan Situbondo - Bidang Pemberdayaan Nelayan
                </div>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" id="username" class="form-control" placeholder="Username : admin" autocomplete="username" required>
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <div class="password-input-container">
                        <input type="password" id="password" class="form-control" placeholder="Situbondo-Naik-Kelas" autocomplete="current-password" required>
                        <button type="button" class="password-toggle" id="passwordToggle">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group mt-3">
                    <label for="captcha" class="form-label">Verifikasi Keamanan</label>
                    <div class="d-flex align-center gap-2">
                        <canvas id="captchaCanvas" width="150" height="40" style="border: 1px solid #ddd; border-radius: var(--rounded-sm);"></canvas>
                        <button type="button" id="reloadCaptchaBtn" class="btn btn-sm btn-gray" style="width: auto;"><i class="fas fa-sync-alt"></i></button>
                    </div>
                    <input type="text" id="captchaInput" class="form-control mt-2" placeholder="Masukkan kode di atas" required autocomplete="off">
                </div>
                <button type="submit" class="btn mt-3">Login</button>
            </form>
        </div>
    </div>

    <div class="container" id="mainApp" style="display: none;">
        <header class="app-header">
            <div class="header-title-container">
                <div class="header-logo">
                    <i class="fas fa-cash-register"></i>
                </div>
                <div>
                    <h1 class="app-title" id="storeNameHeader">UMKM CASH <span class="premium-badge">PREMIUM</span></h1>
                    <p id="currentDate">Rabu, 24 September 2025</p>
                    <!-- PERBAIKAN: Ganti teks supported dengan waktu real-time -->
                    <div class="app-subtitle">
                        <span class="time-badge">
                            <i class="fas fa-clock"></i> <span id="liveClock">00:00:00</span>
                        </span>
                    </div>
                </div>
            </div>
            <div class="header-info">
                <p>Kasir: <span id="loggedInUser">Admin</span></p>
                <p>Shift: <span id="shiftStatus" class="shift-status-badge shift-open">Aktif</span></p>
                <p><a href="#" id="logoutBtn" style="color: white;">Logout</a></p>
            </div>
        </header>

        <main class="app-content">
            <section class="panel menu-panel">
                <h2 class="panel-title">
                    <span>Daftar Menu</span>
                    <span id="menuCount">(0 menu)</span>
                </h2>
                
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="menuSearch" class="search-input" placeholder="Cari menu...">
                </div>
                
                <div class="filter-row">
                    <div class="filter-chip active" data-category="all">Semua</div>
                    </div>
                
                <div class="menu-grid" id="menuGrid">
                    </div>

                <div id="adminPanel" class="admin-panel">
                    <h3 class="panel-title">Admin Panel</h3>
                    <div class="admin-grid">
                        <button id="addMenuBtn" class="btn btn-sm">Tambah Menu</button>
                        <button id="manageCategoriesBtn" class="btn btn-sm">Kelola Kategori</button>
                        <button id="viewReportsBtn" class="btn btn-sm">Laporan</button>
                        <button id="historyBtn" class="btn btn-sm">Histori Transaksi</button>
                        <!-- FITUR BARU: Tambahkan notifikasi badge di tombol Info Pesanan -->
                        <button id="kitchenDisplayBtn" class="btn btn-sm kitchen-notification-badge">
                            Info Pesanan 
                            <span id="kitchenNotificationBadge" class="kitchen-badge" style="display: none;">0</span>
                        </button>
                        <button id="manageMembersBtn" class="btn btn-sm">Kelola Member</button>
                        <button id="manageStoreInfoBtn" class="btn btn-sm">Info Restoran</button>
                        <button id="controlPanelBtn" class="btn btn-sm btn-warning">Kontrol Panel</button>
                        <!-- TOMBOL BARU: Generate Daftar Menu PDF -->
                        <button id="generateMenuPdfBtn" class="btn btn-sm btn-info">Daftar Menu</button>
                        <!-- TOMBOL BARU: Fitur Shift dan Laba -->
                        <!-- PERBAIKAN: Tambahkan tombol Buka Shift yang akan disable jika shift berlangsung -->
                        <button id="openShiftBtn" class="btn btn-sm btn-shift">Buka Shift</button>
                        <button id="closeShiftBtn" class="btn btn-sm btn-shift">Tutup Shift</button>
                        <button id="profitCalculationBtn" class="btn btn-sm btn-profit">Hitung Laba</button>
                        <!-- PERBAIKAN: Ganti nama tombol hapus histori pesanan makan di tempat -->
                        <button id="resetKitchenInfoBtn" class="btn btn-sm btn-danger">Reset Info Pesanan</button>
                        <!-- TAMBAHAN: Tombol Refresh dan Info Aplikasi -->
                        <button id="refreshBtn" class="btn btn-sm">Refresh</button>
                        <button id="appInfoBtn" class="btn btn-sm btn-info">Info Aplikasi</button>
                    </div>
                    
                    <div class="mt-3">
                        <h4 class="panel-title">Backup & Restore</h4>
                        <div class="backup-actions">
                            <button id="backupDataBtn" class="btn btn-sm backup-btn">Backup Data</button>
                            <label for="restoreFile" class="file-label">
                                <i class="fas fa-upload"></i> Restore Data
                            </label>
                            <input type="file" id="restoreFile" class="file-input" accept=".json,.lksbackup">
                        </div>
                        <button id="resetDataBtn" class="btn btn-sm btn-danger mt-2" style="width: 100%;">Reset Data</button>
                    </div>
                </div>
            </section>

            <section class="panel order-panel">
                <h2 class="panel-title">
                    <span>Pesanan</span>
                    <span id="orderCount">(0 item)</span>
                </h2>
                
                <div class="order-type">
                    <div class="order-type-btn active" data-type="dinein">Makan di Tempat</div>
                    <div class="order-type-btn" data-type="takeaway">Bungkus</div>
                </div>
                
                <div class="table-number" id="tableNumberContainer">
                    <label class="form-label">Nomor Meja</label>
                    <select id="tableNumber" class="form-control">
                        <option value="1">Meja 1</option>
                        <option value="2">Meja 2</option>
                        <option value="3">Meja 3</option>
                        <option value="4">Meja 4</option>
                        <option value="5">Meja 5</option>
                    </select>
                </div>

                <div class="form-group mt-2">
                    <label class="form-label">Member (opsional)</label>
                    <div class="member-search-container">
                        <input type="text" id="memberSearchInput" class="form-control" placeholder="Cari nama, ID, atau No. HP...">
                        <div id="memberSearchResults" class="member-search-results"></div>
                    </div>
                </div>
                
                <div id="orderItems">
                    </div>
                
                <div class="note-input">
                    <label class="form-label">Catatan Pesanan (opsional)</label>
                    <textarea id="orderNote" class="form-control" placeholder="Contoh: Pedas, tanpa bawang, dll."></textarea>
                </div>
                
                <div class="summary-container">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="orderSubtotal">Rp 0</span>
                    </div>
                    <div id="discountRow" class="summary-row" style="display: none;">
                        <span>Diskon (0%):</span>
                        <span id="orderDiscount">-Rp 0</span>
                    </div>
                    <div class="summary-row total-row">
                        <span>Total:</span>
                        <span id="orderTotal">Rp 0</span>
                    </div>
                </div>
                
                <button id="processOrderBtn" class="btn btn-success mt-3" disabled>Proses Pesanan</button>
            </section>
        </main>

        <footer class="app-footer">
            <p>&copy; <span id="currentYear"></span> UMKM CASH - Hak Cipta oleh Lentera Karya Situbondo <span class="premium-badge">VERSI PREMIUM</span></p>
            <div class="fishery-support">
                <i class="fas fa-hands-helping"></i> Supported by Dinas Perikanan Situbondo - Bidang Pemberdayaan Nelayan
            </div>
        </footer>
    </div>

    <div id="processOrderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Proses Pembayaran</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0 16px 16px 16px;">
                <div class="tabs">
                    <div class="tab active" data-tab="payment"><i class="fas fa-receipt"></i> Pembayaran</div>
                    <div class="tab" data-tab="details"><i class="fas fa-list-alt"></i> Detail Pesanan</div>
                </div>

                <div class="tab-content active" id="paymentTab">
                    <div class="payment-total-display">
                        <p>Total Tagihan</p>
                        <h3 id="paymentTotal">Rp 0</h3>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Metode Pembayaran</label>
                        <select id="paymentMethod" class="form-control">
                            <option value="cash">Tunai</option>
                            <option value="qris">QRIS</option>
                            <option value="transfer">Transfer Bank</option>
                            <option value="ewallet">E-Wallet</option>
                        </select>
                    </div>

                    <!-- Container for QRIS -->
                    <div id="qrisContainer" class="qris-container" style="display: none;">
                        <h4><i class="fas fa-qrcode"></i> Pembayaran QRIS</h4>
                        <p>Scan QR Code berikut untuk pembayaran:</p>
                        <div class="qris-image-placeholder">
                            <i class="fas fa-qrcode"></i>
                        </div>
                        <p class="mt-2">Total: <strong id="qrisTotal">Rp 0</strong></p>
                        <p class="text-center" style="font-size: 0.8rem; color: var(--gray);">
                            <i class="fas fa-info-circle"></i> QR Code akan otomatis terisi dengan total pembayaran
                        </p>
                    </div>

                    <!-- Container for Cash Payment -->
                    <div id="cashPaymentContainer">
                        <div class="quick-cash-buttons" id="quickCashButtons">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Jumlah Pembayaran</label>
                            <input type="number" id="paymentAmount" class="form-control" placeholder="Masukkan jumlah" min="0">
                        </div>

                        <div id="changeContainer" style="display: none;">
                            <div class="summary-row total-row" style="border-top: 1px solid #ddd;">
                                <span>Kembalian:</span>
                                <span id="paymentChange">Rp 0</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="detailsTab">
                    <div class="form-group">
                        <label class="form-label">Nama Pelanggan</label>
                        <input type="text" id="customerName" class="form-control" placeholder="Masukkan nama pelanggan">
                    </div>
                    <div id="orderSummary">
                        </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn">Batal</button>
                <button id="completePaymentBtn" class="btn btn-success" disabled>
                    <i class="fas fa-check-circle"></i> Selesaikan Pembayaran
                </button>
            </div>
        </div>
    </div>

    <!-- Modal untuk Preview Daftar Menu PDF -->
    <!-- PERBAIKAN: Hapus tombol cetak, pertahankan tombol download -->
    <div id="menuPdfModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title">Preview Daftar Menu PDF</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div id="menuPdfContainer">
                    <!-- Konten akan diisi oleh JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn">Tutup</button>
                <button class="btn btn-success" id="downloadMenuPdfBtn">
                    <i class="fas fa-file-pdf"></i> Download PDF
                </button>
                <!-- PERBAIKAN: Hapus tombol cetak -->
            </div>
        </div>
    </div>

    <!-- Modals lainnya tetap sama seperti sebelumnya -->
    <div id="menuModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah Menu Baru</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="menuForm">
                    <input type="hidden" id="menuId">
                    <div class="form-group">
                        <label class="form-label">Nama Menu</label>
                        <input type="text" id="menuName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Kategori</label>
                        <select id="menuCategory" class="form-control" required>
                            </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Harga</label>
                        <input type="number" id="menuPrice" class="form-control" required min="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Gambar (URL)</label>
                        <input type="text" id="menuImage" class="form-control" placeholder="Masukkan URL gambar">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Deskripsi (opsional)</label>
                        <textarea id="menuDescription" class="form-control"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn">Batal</button>
                <button class="btn btn-success" id="saveMenuBtn">Simpan</button>
            </div>
        </div>
    </div>

    <div id="manageCategoriesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Kelola Kategori</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="categoriesList">
                    </div>
                <div class="form-group mt-3">
                    <input type="text" id="newCategoryName" class="form-control" placeholder="Nama kategori baru">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn">Tutup</button>
                <button class="btn btn-success" id="addCategoryBtn">Tambah Kategori</button>
            </div>
        </div>
    </div>

    <div id="reportsModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">Laporan</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0 16px 16px 16px;">
                 <div class="tabs">
                    <div class="tab active" data-tab="salesReport"><i class="fas fa-chart-line"></i> Laporan Penjualan</div>
                </div>
                
                <div class="tab-content active" id="salesReportTab">
                    <div class="form-group mt-3">
                        <label class="form-label">Periode</label>
                        <select id="reportPeriod" class="form-control">
                            <option value="today">Hari Ini</option>
                            <option value="week">Minggu Ini</option>
                            <option value="month">Bulan Ini</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div id="customDateRange" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">Dari Tanggal</label>
                            <input type="date" id="reportStartDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Sampai Tanggal</label>
                            <input type="date" id="reportEndDate" class="form-control">
                        </div>
                    </div>
                    <div id="reportResults" class="mt-3 printable-area"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn">Tutup</button>
                <button class="btn btn-success" id="generateReportBtn">Generate Laporan</button>
                <button class="btn btn-info" id="downloadReportBtn" style="display: none;"><i class="fas fa-file-pdf"></i> Unduh PDF</button>
                <button class="btn btn-primary" id="printReportBtn" style="display: none;"><i class="fas fa-print"></i> Cetak Laporan</button>
            </div>
        </div>
    </div>
    
    <!-- PERBAIKAN: Modal Histori Transaksi dengan tombol cetak ulang -->
    <div id="historyModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title">Histori Transaksi</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="historySearchInput" class="search-input" placeholder="Cari berdasarkan Kode Transaksi atau Nama Pelanggan...">
                </div>
                <div id="historyResultsContainer" style="max-height: 60vh; overflow-y: auto; margin-top: 15px;">
                    <div id="historyResults" class="printable-area"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn">Tutup</button>
                <button class="btn btn-info" id="downloadHistoryBtn"><i class="fas fa-file-pdf"></i> Unduh PDF</button>
                <button class="btn btn-primary" id="printHistoryBtn"><i class="fas fa-print"></i> Cetak Histori</button>
            </div>
        </div>
    </div>

    <!-- Tambahkan kode ini di dalam modal histori transaksi, setelah elemen pencarian -->
<div class="filter-row" style="margin: 10px 0; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; padding: 10px; background: #f8f9fa; border-radius: var(--rounded);">
    <div style="display: flex; align-items: center; gap: 5px;">
        <label for="historyStartDate" style="margin-bottom: 0; font-weight: 500;">Dari:</label>
        <input type="date" id="historyStartDate" class="form-control" style="width: 150px;">
    </div>
    <div style="display: flex; align-items: center; gap: 5px;">
        <label for="historyEndDate" style="margin-bottom: 0; font-weight: 500;">Sampai:</label>
        <input type="date" id="historyEndDate" class="form-control" style="width: 150px;">
    </div>
    <button class="btn btn-sm btn-info" id="applyHistoryFilter" style="padding: 5px 15px;">Terapkan Filter</button>
    <button class="btn btn-sm btn-warning" id="resetHistoryFilter" style="padding: 5px 15px;">Reset Filter</button>
</div>

<!-- Tambahkan elemen untuk menampilkan info filter aktif -->
<div id="historyFilterDisplay" style="font-size: 12px; color: #666; margin: 5px 0; font-style: italic;"></div>
    
    <!-- Modal untuk Cetak Ulang Struk dari Histori -->
    <div id="historyReceiptModal" class="modal">
        <div class="modal-content" style="max-width: 350px;">
            <div class="modal-header">
                <h3 class="modal-title">Cetak Ulang Struk</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="historyReceiptModalBody" style="background: #eee;">
                <!-- Struk akan dimuat di sini -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn">Tutup</button>
                <button class="btn btn-info" id="downloadHistoryReceiptPdfBtn"><i class="fas fa-file-pdf"></i> Unduh PDF</button>
                <button class="btn btn-success" id="printHistoryReceiptBtn"><i class="fas fa-print"></i> Cetak Struk</button>
            </div>
        </div>
    </div>

    <!-- FITUR BARU: Modal untuk Info Pesanan Dapur tanpa Tab History -->
    <div id="kitchenDisplayModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">Info Pesanan Dapur</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0 16px 16px 16px;">
                <div class="tabs">
                    <div class="tab active" data-tab="kitchenActive"><i class="fas fa-utensils"></i> Pesanan Aktif</div>
                </div>
                
                <!-- Tab Pesanan Aktif -->
                <div class="tab-content active" id="kitchenActiveTab">
                    <div class="kitchen-status">
                        <h4>Pesanan Masuk (Refresh otomatis setiap 30 detik)</h4>
                        <div id="kitchenOrders">
                            </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn">Tutup</button>
                <button class="btn btn-success" id="refreshKitchenBtn">Refresh Manual</button>
            </div>
        </div>
    </div>

    <div id="manageMembersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Kelola Member</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <button id="showAddMemberFormBtn" class="btn btn-sm mb-3">Tambah Member Baru</button>
                
                <div class="search-container mb-3">
                    <i class="fas fa-search"></i>
                    <input type="text" id="manageMemberSearchInput" class="search-input" placeholder="Cari member (nama, ID, No. HP)...">
                </div>

                <div class="member-form" id="memberFormContainer" style="display:none;">
                    <h4 id="memberFormTitle">Tambah Member Baru</h4>
                    <form id="memberForm">
                        <input type="hidden" id="memberIdInput">
                        <div class="form-group">
                            <label class="form-label">Nama Member</label>
                            <input type="text" id="memberName" class="form-control" placeholder="Masukkan nama member" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Nomor Telepon</label>
                            <input type="tel" id="memberPhone" class="form-control" placeholder="Masukkan nomor telepon" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Alamat</label>
                            <textarea id="memberAddress" class="form-control" placeholder="Masukkan alamat"></textarea>
                        </div>
                         <div id="memberAdminFields" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">Total Transaksi</label>
                                <input type="number" id="memberTransactions" class="form-control" disabled>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Total Belanja</label>
                                <input type="text" id="memberTotalSpent" class="form-control" disabled>
                            </div>
                        </div>
                        <div class="d-flex gap-2">
                             <button type="button" class="btn btn-warning" id="cancelMemberFormBtn">Batal</button>
                             <button type="submit" class="btn btn-success" id="saveMemberBtn">Simpan Member</button>
                        </div>
                    </form>
                    <hr class="mt-3 mb-3">
                </div>
                <div id="membersList">
                    </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn">Tutup</button>
                <button class="btn btn-danger" id="deleteMemberBtn" style="display: none;">Hapus Member</button>
            </div>
        </div>
    </div>

    <div id="manageStoreInfoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Kelola Info Restoran</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="storeInfoForm">
                    <div class="form-group">
                        <label class="form-label">Nama Developer</label>
                        <input type="text" id="storeName" class="form-control" required readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nama Usaha (UMKM)</label>
                        <input type="text" id="umkmName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Alamat Restoran</label>
                        <textarea id="storeAddress" class="form-control" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nomor Telepon/WA</label>
                        <input type="text" id="storePhone" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" id="storeEmail" class="form-control" placeholder="Contoh: resto@email.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Jumlah Meja</label>
                        <input type="number" id="tableCount" class="form-control" min="1" value="5" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn">Batal</button>
                <button class="btn btn-success" id="saveStoreInfoBtn">Simpan</button>
            </div>
        </div>
    </div>

    <div id="controlPanelModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Kontrol Panel</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0 16px 16px 16px;">
                <div class="tabs">
                    <div class="tab active" data-tab="users"><i class="fas fa-users-cog"></i> Pengguna</div>
                    <div class="tab" data-tab="security"><i class="fas fa-shield-alt"></i> Keamanan</div>
                    <div class="tab" data-tab="permissions"><i class="fas fa-key"></i> Hak Akses</div>
                    <div class="tab" data-tab="shiftSettings"><i class="fas fa-cash-register"></i> Pengaturan Shift & Laba</div>
                </div>

                <div class="tab-content active" id="usersTab">
                    <h4 class="mt-3">Manajemen Pengguna</h4>
                    <button id="showAddUserFormBtn" class="btn btn-sm mt-2 mb-3">Tambah Pengguna Baru</button>
                    <div id="userFormContainer" style="display:none; background: #f9f9f9; padding: 12px; border-radius: var(--rounded-sm); margin-bottom: 16px;">
                        <h5 id="userFormTitle">Tambah Pengguna</h5>
                        <form id="userForm">
                            <input type="hidden" id="userIdInput">
                            <div class="form-group">
                                <label class="form-label">Nama Lengkap</label>
                                <input type="text" id="userName" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Username</label>
                                <input type="text" id="userUsername" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Password</label>
                                <div class="password-input-container">
                                    <input type="password" id="userPassword" class="form-control" placeholder="Kosongkan jika tidak ingin mengubah">
                                    <button type="button" class="password-toggle user-password-toggle">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Hak Akses (Role)</label>
                                <select id="userRole" class="form-control">
                                    <option value="cashier">Kasir</option>
                                    <option value="admin">Admin</option>
                                </select>
                            </div>
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-warning" id="cancelUserFormBtn">Batal</button>
                                <button type="submit" class="btn btn-success" id="saveUserBtn">Simpan</button>
                            </div>
                        </form>
                    </div>
                    <div id="usersList"></div>
                </div>

                <div class="tab-content" id="securityTab">
                    <h4 class="mt-3">Pengaturan Keamanan</h4>
                    <form id="itemSecurityForm" class="mt-2">
                        <div class="form-group">
                            <label class="form-label">Password Keamanan Edit/Hapus Item</label>
                            <div class="password-input-container">
                                <input type="password" id="itemSecurityCode" class="form-control" required>
                                <button type="button" class="password-toggle security-password-toggle">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-sm btn-info">Ubah Password</button>
                    </form>
                    <hr class="mt-3 mb-3">
                    <form id="panelSecurityForm" class="mt-2">
                        <div class="form-group">
                            <label class="form-label">Password Keamanan Kontrol Panel</label>
                            <div class="password-input-container">
                                <input type="password" id="panelSecurityCode" class="form-control" required>
                                <button type="button" class="password-toggle security-password-toggle">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-sm btn-info">Ubah Password</button>
                    </form>
                    
                    <hr class="mt-3 mb-3">
                    <h4 class="mt-3">Pengaturan Diskon</h4>
                    <form id="discountSettingsForm" class="mt-2">
                        <div class="form-group">
                            <label class="form-label">Diskon Member (%)</label>
                            <input type="number" id="memberDiscount" class="form-control" min="0" max="100" value="2" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Diskon Pelanggan Biasa (%)</label>
                            <input type="number" id="nonMemberDiscount" class="form-control" min="0" max="100" value="0" required>
                        </div>
                        <button type="submit" class="btn btn-sm btn-success">Simpan Pengaturan Diskon</button>
                    </form>
                    <hr class="mt-3 mb-3">
                    <h4 class="mt-3">Ubah Password Login Anda</h4>
                    <form id="changeOwnPasswordForm" class="mt-2">
                        <div class="form-group">
                            <label class="form-label">Password Saat Ini</label>
                            <div class="password-input-container">
                                <input type="password" id="currentPassword" class="form-control" required>
                                <button type="button" class="password-toggle current-password-toggle">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                         <div class="form-group">
                            <label class="form-label">Password Baru</label>
                            <div class="password-input-container">
                                <input type="password" id="newPassword" class="form-control" required>
                                <button type="button" class="password-toggle new-password-toggle">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-sm btn-success">Simpan Password Baru</button>
                    </form>
                </div>
                
                <div class="tab-content" id="permissionsTab">
                    <h4 class="mt-3">Manajemen Hak Akses</h4>
                    <div class="form-group">
                        <label class="form-label">Pilih Pengguna</label>
                        <select id="permissionUserSelect" class="form-control">
                            <option value="">-- Pilih Pengguna --</option>
                        </select>
                    </div>
                    
                    <div id="permissionsContainer" class="permissions-container" style="display: none;">
                        <div class="permission-group">
                            <h5>Menu Utama</h5>
                            <div class="permission-item">
                                <div>
                                    <div class="permission-name">Tambah Menu</div>
                                    <div class="permission-description">Akses untuk menambah menu baru</div>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="permission-checkbox" data-permission="add_menu" id="perm_add_menu">
                                    <label for="perm_add_menu"></label>
                                </div>
                            </div>
                            <div class="permission-item">
                                <div>
                                    <div class="permission-name">Edit Menu</div>
                                    <div class="permission-description">Akses untuk mengedit menu yang ada</div>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="permission-checkbox" data-permission="edit_menu" id="perm_edit_menu">
                                    <label for="perm_edit_menu"></label>
                                </div>
                            </div>
                            <div class="permission-item">
                                <div>
                                    <div class="permission-name">Hapus Menu</div>
                                    <div class="permission-description">Akses untuk menghapus menu</div>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="permission-checkbox" data-permission="delete_menu" id="perm_delete_menu">
                                    <label for="perm_delete_menu"></label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="permission-group">
                            <h5>Kelola Data</h5>
                            <div class="permission-item">
                                <div>
                                    <div class="permission-name">Kelola Kategori</div>
                                    <div class="permission-description">Akses untuk mengelola kategori menu</div>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="permission-checkbox" data-permission="manage_categories" id="perm_manage_categories">
                                    <label for="perm_manage_categories"></label>
                                </div>
                            </div>
                            <div class="permission-item">
                                <div>
                                    <div class="permission-name">Kelola Member</div>
                                    <div class="permission-description">Akses untuk mengelola data member</div>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="permission-checkbox" data-permission="manage_members" id="perm_manage_members">
                                    <label for="perm_manage_members"></label>
                                </div>
                            </div>
                            <div class="permission-item">
                                <div>
                                    <div class="permission-name">Info Restoran</div>
                                    <div class="permission-description">Akses untuk mengubah info restoran</div>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="permission-checkbox" data-permission="manage_store_info" id="perm_manage_store_info">
                                    <label for="perm_manage_store_info"></label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="permission-group">
                            <h5>Laporan dan Transaksi</h5>
                            <div class="permission-item">
                                <div>
                                    <div class="permission-name">Lihat Laporan</div>
                                    <div class="permission-description">Akses untuk melihat laporan penjualan</div>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="permission-checkbox" data-permission="view_reports" id="perm_view_reports">
                                    <label for="perm_view_reports"></label>
                                </div>
                            </div>
                            <div class="permission-item">
                                <div>
                                    <div class="permission-name">Histori Transaksi</div>
                                    <div class="permission-description">Akses untuk melihat histori transaksi</div>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="permission-checkbox" data-permission="transaction_history" id="perm_transaction_history">
                                    <label for="perm_transaction_history"></label>
                                </div>
                            </div>
                            <div class="permission-item">
                                <div>
                                    <div class="permission-name">Info Pesanan Dapur</div>
                                    <div class="permission-description">Akses untuk melihat info pesanan dapur</div>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="permission-checkbox" data-permission="kitchen_display" id="perm_kitchen_display">
                                    <label for="perm_kitchen_display"></label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="permission-group">
                            <h5>Administrasi</h5>
                            <div class="permission-item">
                                <div>
                                    <div class="permission-name">Kontrol Panel</div>
                                    <div class="permission-description">Akses ke kontrol panel sistem</div>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="permission-checkbox" data-permission="control_panel" id="perm_control_panel">
                                    <label for="perm_control_panel"></label>
                                </div>
                            </div>
                            <div class="permission-item">
                                <div>
                                    <div class="permission-name">Backup & Restore</div>
                                    <div class="permission-description">Akses untuk backup dan restore data</div>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="permission-checkbox" data-permission="backup_restore" id="perm_backup_restore">
                                    <label for="perm_backup_restore"></label>
                                </div>
                            </div>
                            <div class="permission-item">
                                <div>
                                    <div class="permission-name">Reset Data</div>
                                    <div class="permission-description">Akses untuk mereset semua data</div>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="permission-checkbox" data-permission="reset_data" id="perm_reset_data">
                                    <label for="perm_reset_data"></label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- PERBAIKAN: Tambah permission untuk fitur baru -->
                        <div class="permission-group">
                            <h5>Fitur Baru</h5>
                            <div class="permission-item">
                                <div>
                                    <div class="permission-name">Manajemen Shift</div>
                                    <div class="permission-description">Akses untuk membuka dan menutup shift</div>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="permission-checkbox" data-permission="shift_management" id="perm_shift_management">
                                    <label for="perm_shift_management"></label>
                                </div>
                            </div>
                            <div class="permission-item">
                                <div>
                                    <div class="permission-name">Perhitungan Laba</div>
                                    <div class="permission-description">Akses untuk menghitung dan melihat laporan laba</div>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="permission-checkbox" data-permission="profit_calculation" id="perm_profit_calculation">
                                    <label for="perm_profit_calculation"></label>
                                </div>
                            </div>
                            <div class="permission-item">
                                <div>
                                    <div class="permission-name">Hapus Histori Pesanan Dapur</div>
                                    <div class="permission-description">Akses untuk menghapus histori pesanan dapur</div>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="permission-checkbox" data-permission="delete_kitchen_history" id="perm_delete_kitchen_history">
                                    <label for="perm_delete_kitchen_history"></label>
                                </div>
                            </div>
                            <!-- PERBAIKAN: Tambah permission untuk cetak ulang struk -->
                            <div class="permission-item">
                                <div>
                                    <div class="permission-name">Cetak Ulang Struk</div>
                                    <div class="permission-description">Akses untuk mencetak ulang struk dari histori transaksi</div>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="permission-checkbox" data-permission="reprint_receipt" id="perm_reprint_receipt">
                                    <label for="perm_reprint_receipt"></label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="permissionsActions" class="d-flex gap-2 mt-3" style="display: none;">
                        <button type="button" class="btn btn-sm btn-warning" id="resetPermissionsBtn">Reset ke Default</button>
                        <button type="button" class="btn btn-sm btn-success" id="savePermissionsBtn">Simpan Hak Akses</button>
                    </div>
                </div>
                
                <!-- PERBAIKAN: Tab baru untuk pengaturan shift dan laba -->
                <div class="tab-content" id="shiftSettingsTab">
                    <h4 class="mt-3">Pengaturan Shift & Perhitungan Laba</h4>
                    
                    <div class="cash-management-container">
                        <h5 class="panel-title">Pengaturan Shift</h5>
                        <div class="form-group">
                            <label class="form-label">Waktu Shift Default (Jam)</label>
                            <input type="number" id="defaultShiftHours" class="form-control" min="1" max="24" value="8">
                            <small class="form-text text-muted">Durasi default shift penjualan dalam jam</small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Auto Close Shift</label>
                            <div class="form-check">
                                <input type="checkbox" id="autoCloseShift" class="form-check-input">
                                <label class="form-check-label" for="autoCloseShift">Otomatis tutup shift setelah waktu tertentu</label>
                            </div>
                        </div>
                        
                        <hr class="mt-3 mb-3">
                        
                        <h5 class="panel-title">Pengaturan Perhitungan Laba</h5>
                        <div class="form-group">
                            <label class="form-label">Kode Keamanan Akses Laba</label>
                            <div class="password-input-container">
                                <input type="password" id="profitAccessCode" class="form-control" placeholder="Masukkan kode keamanan">
                                <button type="button" class="password-toggle profit-password-toggle">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <small class="form-text text-muted">Kode ini diperlukan untuk mengakses fitur perhitungan laba</small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Konfirmasi Kode Keamanan</label>
                            <div class="password-input-container">
                                <input type="password" id="profitAccessCodeConfirm" class="form-control" placeholder="Konfirmasi kode keamanan">
                                <button type="button" class="password-toggle profit-confirm-toggle">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Persentase HPP Default (%)</label>
                            <input type="number" id="defaultProfitCOGS" class="form-control" min="0" max="100" value="60">
                            <small class="form-text text-muted">Persentase default Harga Pokok Penjualan</small>
                        </div>
                        
                        <button class="btn btn-success" id="saveShiftProfitSettingsBtn">Simpan Pengaturan</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn">Tutup</button>
            </div>
        </div>
    </div>
    
    <div id="passwordPromptModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title" id="passwordPromptTitle">Masukkan Password Keamanan</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="passwordPromptForm">
                    <div class="form-group">
                         <label class="form-label" id="passwordPromptMessage">Untuk melanjutkan, masukkan password.</label>
                         <div class="password-input-container">
                             <input type="password" id="passwordPromptInput" class="form-control" required>
                             <button type="button" class="password-toggle prompt-password-toggle">
                                 <i class="fas fa-eye"></i>
                             </button>
                         </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn">Batal</button>
                <button class="btn btn-success" id="passwordPromptSubmit">Lanjutkan</button>
            </div>
        </div>
    </div>

    <div id="confirmationModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title" id="confirmTitle">Konfirmasi</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Apakah Anda yakin?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning modal-close-btn" id="confirmCancel">Batal</button>
                <button class="btn" id="confirmAction">Lanjutkan</button>
            </div>
        </div>
    </div>

    <div id="receiptModal" class="modal">
        <div class="modal-content" style="max-width: 350px;">
            <div class="modal-header no-print">
                <h3 class="modal-title">Struk Pembayaran</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="receiptModalBody" style="background: #eee;">
                </div>
            <div class="modal-footer no-print">
                <button class="btn btn-warning modal-close-btn">Tutup</button>
                <button class="btn btn-info" id="downloadReceiptPdfBtn"><i class="fas fa-file-pdf"></i> Unduh PDF</button>
                <button class="btn btn-success" id="printReceiptBtn"><i class="fas fa-print"></i> Cetak</button>
            </div>
        </div>
    </div>

    <div id="ktaModal" class="modal">
        <div class="modal-content" style="max-width: 380px;">
             <div class="modal-header">
                <h3 class="modal-title">Kartu Tanda Anggota</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="ktaModalBody">
                <div id="ktaCard">
                    <div class="kta-header">
                        <div class="kta-store-info">
                            <h3 id="ktaStoreName">NAMA RESTO</h3>
                            <p id="ktaStoreContact">Alamat, No. WA, Email</p>
                        </div>
                    </div>
                    <div class="kta-body">
                        <h2 id="ktaMemberName">Nama Member</h2>
                        <p id="ktaMemberId">ID: M250924103000</p>
                        <div class="kta-qrcode" id="ktaQrcodeImg">
                        </div>
                    </div>
                    <div class="kta-footer">
                        Kartu ini adalah bukti keanggotaan resmi.
                    </div>
                </div>
            </div>
            <div class="modal-footer no-print">
                 <button class="btn btn-warning modal-close-btn">Tutup</button>
                 <button class="btn btn-info" id="downloadKtaPdfBtn"><i class="fas fa-file-pdf"></i> Unduh PDF</button>
                 </div>
        </div>
    </div>
    
    <div id="print-container" style="display:none;"></div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/id.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="main.js"></script>
</body>
</html>
